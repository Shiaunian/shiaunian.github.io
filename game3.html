<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T2日檢疫挑戰系統</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root {
  --bg-primary: #1a1b1e;
  --bg-secondary: #2d2d30;
  --primary: #7289da;
  --primary-dark: #5c6fb1;
  --text-primary: #ffffff;
  --text-secondary: #a0a0a0;
  --danger: #ef4444;
  --warning: #f59e0b;
  --success: #22c55e;
  --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  --border-color: rgba(255, 255, 255, 0.1);
  --info: #3b82f6;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "微軟正黑體", Arial, sans-serif;
  background: var(--bg-primary);
  min-height: 100vh;
  padding: 12px;
  color: var(--text-primary);
}

.container {
  max-width: 480px;
  margin: 0 auto;
  height: calc(100vh - 24px);
  overflow-y: auto;
  background: var(--bg-secondary);
  border-radius: 12px;
  box-shadow: var(--shadow);
}

.header {
  background: var(--bg-secondary);
  padding: 15px;
  border-bottom: 1px solid var(--border-color);
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-title {
  display: flex;
  flex-direction: column;
  margin-bottom: 10px;
}

.title-text {
  font-size: 1.3rem;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 8px;
  justify-content: space-between;
}

.user-info {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin-top: 5px;
}

.connection-status {
  background-color: var(--success);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 0.8rem;
  margin-left: 8px;
}

.btn {
  padding: 8px 16px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  flex: 1;
}

.btn-primary {
  background: var(--primary);
  color: var(--text-primary);
}

.btn-primary:hover {
  background: var(--primary-dark);
}

.btn-secondary {
  background: var(--warning);
  color: var(--text-primary);
}

.btn-danger {
  background: var(--danger);
  color: var(--text-primary);
}

.challenge-item {
  padding: 15px;
  border-bottom: 1px solid var(--border-color);
}

.challenge-title {
  font-size: 1.1rem;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.challenge-info {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-bottom: 12px;
}

.challenge-actions {
  display: flex;
  gap: 8px;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal {
  background: var(--bg-secondary);
  width: 90%;
  max-width: 400px;
  max-height: 80vh;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
}

.modal-header {
  padding: 15px;
  background: var(--primary);
  color: var(--text-primary);
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
}

.close-btn {
  background: none;
  border: none;
  color: var(--text-primary);
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0 8px;
}

.modal-content {
  padding: 15px;
  overflow-y: auto;
  max-height: calc(80vh - 56px);
  /* 🔧 新增：確保滾動條顯示 */
  min-height: 200px; /* 設定最小高度 */
}

/* 🔧 新增：確保排行榜內容可滾動 */
.leaderboard-container {
  max-height: calc(60vh - 100px);
  overflow-y: auto;
  padding-right: 5px; /* 為滾動條留空間 */
}

.leaderboard-item {
  display: flex;
  align-items: center;
  padding: 8px 12px;
  border-bottom: 1px solid var(--border-color);
  transition: background-color 0.3s;
}

.leaderboard-item.current-user {
  background: rgba(114, 137, 218, 0.1);
  border-left: 3px solid var(--primary);
}

.rank {
  min-width: 30px;
  font-weight: bold;
  color: var(--primary);
}

.user-name {
  flex: 1;
  margin: 0 10px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.score {
  font-weight: bold;
  color: var(--primary);
  margin-left: auto;
}

.empty-leaderboard {
  text-align: center;
  padding: 20px;
  color: var(--text-secondary);
}

.exam-container {
  padding: 20px;
}

.exam-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.timer {
  font-size: 1.2rem;
  color: var(--primary);
}

.question {
  background: var(--bg-secondary);
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
}

.options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-top: 20px;
}

.option-btn {
  width: 100%;
  text-align: left;
  padding: 12px;
}

.option-btn.correct {
  background: var(--success);
}

.option-btn.wrong {
  background: var(--danger);
}

.exam-result {
  text-align: center;
  padding: 20px;
}

.exam-result h2 {
  margin-bottom: 20px;
}

.exam-result p {
  margin-bottom: 10px;
}

.exam-result button {
  margin: 10px;
}

::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-primary);
}

::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--primary-dark);
}

.sudoku-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 4px;
  background: var(--border-color);
  padding: 4px;
  border-radius: 8px;
  margin-bottom: 20px;
}

.sudoku-cell {
  width: 100%;
  aspect-ratio: 1;
  background: var(--bg-primary);
  border: none;
  border-radius: 4px;
  color: var(--text-primary);
  font-size: 1.5rem;
  text-align: center;
  cursor: pointer;
}

.sudoku-cell:disabled {
  background: var(--bg-secondary);
  color: var(--text-secondary);
  cursor: not-allowed;
}

.sudoku-cell:focus {
  outline: 2px solid var(--primary);
}

.sudoku-cell::-webkit-inner-spin-button,
.sudoku-cell::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.loading {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-secondary);
}

.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid #f3f3f3;
  border-top: 3px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 10px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
</head>
<body>
<!-- 載入中畫面 -->
<div id="loadingScreen" class="container">
<div class="loading">
  <div class="loading-spinner"></div>
  正在驗證登入狀態...
</div>
</div>

<!-- 主要內容 -->
<div id="mainContent" class="container" style="display: none;">
<header class="header">
  <div class="header-title">
      <div class="title-text">
          <span>🎯</span>
          <h1>T2日檢疫挑戰系統</h1>
          <button class="btn btn-danger" onclick="logout()">登出</button>
      </div>
      <div class="user-info">
          <span id="currentUserWelcome">歡迎回來，載入中...</span>
          <span class="connection-status" id="connectionStatus">用戶連線中</span>
      </div>
  </div>
  <div class="header-actions">
      <button class="btn btn-primary" onclick="backToT2()">返回T2日</button>
  </div>
</header>

<div class="challenge-item">
  <h3 class="challenge-title">分流考試挑戰</h3>
  <p class="challenge-info" style="color:#ef4444;">每題60秒作答時間，共10題</p>
  <div class="challenge-actions">
      <button class="btn btn-primary" onclick="startExam('basic')">考試</button>
      <button class="btn btn-secondary" onclick="showLeaderboard('basic')">排行榜</button>
  </div>
</div>

<div class="challenge-item">
  <h3 class="challenge-title">⭐英文考試基礎版⭐</h3>
  <p class="challenge-info" style="color:#ef4444;">每題15秒作答時間，共15題 一題10分</p>
  <div class="challenge-actions">
      <button class="btn btn-primary" onclick="startExam('food1')">考試</button>
      <button class="btn btn-secondary" onclick="showLeaderboard('food1')">排行榜</button>
  </div>
</div>

<div class="challenge-item">
  <h3 class="challenge-title">⭐英文考試進階版⭐</h3>
  <p class="challenge-info" style="color:#ef4444;">每題10秒作答時間，共20題 一題10分</p>
  <div class="challenge-actions">
      <button class="btn btn-primary" onclick="startExam('food')">考試</button>
      <button class="btn btn-secondary" onclick="showLeaderboard('food')">排行榜</button>
  </div>
</div>

<div class="challenge-item">
  <h3 class="challenge-title">⭐前導複查挑戰⭐</h3>
  <p class="challenge-info" style="color:#ef4444;">每題60秒作答時間，共15題 一題10分</p>
  <div class="challenge-actions">
      <button class="btn btn-primary" onclick="startExam('precheck')">考試</button>
      <button class="btn btn-secondary" onclick="showLeaderboard('precheck')">排行榜</button>
  </div>
</div>

<div class="challenge-item">
  <h3 class="challenge-title">規定挑戰</h3>
  <p class="challenge-info" style="color:#ef4444;">每題60秒作答時間，共10題 一題10分</p>
  <div class="challenge-actions">
      <button class="btn btn-primary" onclick="startExam('rule')">考試</button>
      <button class="btn btn-secondary" onclick="showLeaderboard('rule')">排行榜</button>
  </div>
</div>

<div class="challenge-item">
  <h3 class="challenge-title">🇰🇷韓語挑戰基礎版🇰🇷</h3>
  <p class="challenge-info" style="color:#ef4444;">每題12秒作答時間，共15題 一題10分</p>
  <div class="challenge-actions">
      <button class="btn btn-primary" onclick="startExam('korean')">考試</button>
      <button class="btn btn-secondary" onclick="showLeaderboard('korean')">排行榜</button>
  </div>
</div>

<div class="challenge-item">
  <h3 class="challenge-title">🇻🇳越南語詞彙挑戰🇻🇳</h3>
  <p class="challenge-info" style="color:#ef4444;">每題12秒作答時間，共15題 一題10分</p>
  <div class="challenge-actions">
      <button class="btn btn-primary" onclick="startExam('vietnamese')">考試</button>
      <button class="btn btn-secondary" onclick="showLeaderboard('vietnamese')">排行榜</button>
  </div>
</div>

<div class="challenge-item">
  <h3 class="challenge-title">初階數獨挑戰</h3>
  <p class="challenge-info" style="color:#ef4444;">每題80秒作答時間，共5題 一題10分</p>
  <div class="challenge-actions">
      <button class="btn btn-primary" onclick="startExam('sudoku')">考試</button>
      <button class="btn btn-secondary" onclick="showLeaderboard('sudoku')">排行榜</button>
  </div>
</div>
</div>

<!-- 排行榜模態視窗 -->
<div class="modal-overlay" id="leaderboardModal">
<div class="modal">
  <div class="modal-header">
      <h2 id="modalTitle">排行榜</h2>
      <button class="close-btn" onclick="hideLeaderboard()">×</button>
  </div>
  <div class="modal-content" id="leaderboardContent">
  </div>
</div>
</div>

<script>
// Firebase 配置
const firebaseConfig = {
  apiKey: "AIzaSyBVC5zJl6LCKFrsdN7_JkVsZHmqALuixwE",
  authDomain: "openexammodal.firebaseapp.com",
  databaseURL: "https://openexammodal-default-rtdb.firebaseio.com",
  projectId: "openexammodal",
  storageBucket: "openexammodal.firebasestorage.app",
  messagingSenderId: "336901617556",
  appId: "1:336901617556:web:53f60cddf513b2ea6a4181"
};

// 初始化 Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// 全域變數
let currentUser = null;
let usersData = [];
let currentExam = null;
let currentQuestions = [];
let currentQuestionIndex = 0;
let examTimer = null;
let questionStartTime = null;
let userScores = {
  fastAnswers: 0,
  correctAnswers: 0
};

// 工具函數：從數組中移除特定元素
Array.prototype.remove = function(element) {
  const index = this.indexOf(element);
  if (index > -1) {
      this.splice(index, 1);
  }
};

// 強制登出函數
function forceLogout(message = '登入驗證失敗，請重新登入') {
  localStorage.removeItem('t2_login');
  localStorage.removeItem('t2_login_time');
  localStorage.removeItem('t2_login_user');
  alert(message);
  window.location.href = 'index.html';
}

// 檢查登入狀態和時效
function checkLoginStatus() {
  const loginFlag = localStorage.getItem('t2_login');
  const loginTime = localStorage.getItem('t2_login_time');
  const loginUser = localStorage.getItem('t2_login_user');

  if (loginFlag !== 'yes' || !loginTime || !loginUser) {
      forceLogout('未檢測到有效登入狀態');
      return false;
  }

  // 檢查登入時效 (1小時)
  const now = Date.now();
  const loginTimeStamp = parseInt(loginTime);
  const LIMIT = 3600000; // 1小時

  if (now - loginTimeStamp > LIMIT) {
      forceLogout('登入時間已超過1小時，請重新登入');
      return false;
  }

  return loginUser;
}

// 載入用戶資料庫
async function loadUsersData() {
  try {
      const response = await fetch('password.json');
      if (!response.ok) {
          throw new Error('無法載入用戶資料庫');
      }
      const data = await response.json();
      usersData = Array.isArray(data) ? data : [data];
      return true;
  } catch (error) {
      console.error('載入用戶資料庫失敗:', error);
      forceLogout('系統錯誤：無法載入用戶資料庫');
      return false;
  }
}

// ✅ 同時驗證用戶名和密碼，確保找到正確用戶
function validateUser(username) {
  console.log('🔍 驗證用戶:', username);
  console.log('📊 用戶資料庫:', usersData);
  
  const storedPassword = localStorage.getItem('t2_login_password');
  console.log('🔑 儲存的密碼:', storedPassword);
  
  const user = usersData.find(u => u.username === username && u.password === storedPassword);
  
  if (!user) {
      console.error('❌ 找不到用戶:', username);
      forceLogout('用戶帳號不存在於系統中');
      return null;
  }
  
  console.log('✅ 找到用戶:', user);
  return user;
}



// 顯示用戶歡迎訊息
function showWelcomeMessage(user) {
  const welcomeElement = document.getElementById('currentUserWelcome');
  const displayName = user.welcome || user._comment || user.username;
  welcomeElement.textContent = `歡迎回來，${displayName}`;  // 只在頁面顯示時加上"歡迎回來"
}

// 主要初始化函數
async function initializePage() {
    try {
        // 1. 檢查登入狀態
        const loginUser = checkLoginStatus();
        if (!loginUser) {
            return;
        }

        // 2. 載入用戶資料庫
        const loadSuccess = await loadUsersData();
        if (!loadSuccess) {
            return;
        }

        // 3. 驗證用戶是否存在於資料庫中
        const user = validateUser(loginUser);
        if (!user) {
            return;
        }

        // 4. 設定當前用戶
        currentUser = user;

        // 5. 顯示歡迎訊息
        showWelcomeMessage(user);

        // 6. 顯示主要內容
        document.getElementById('loadingScreen').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';

        // 🏆 7. 載入所有榜首資訊
        await loadAllChampions();

    } catch (error) {
        console.error('頁面初始化失敗:', error);
        forceLogout('系統初始化失敗，請重新登入');
    }
}

// 考試題庫 - 修正題庫鍵值對應
const examQuestions = {
  "basic": [
  {
    question: "秤重卡片多少克為單位？",
    options: ["500克", "300克", "600克", "800克"],
    correct: 2
  },
  {
    question: "旅客來時分流應該如何分？",
    options: [
      "一條線塞滿再換一條塞",
      "均分各線",
      "一律先丟3線滿了再換其他線",
      "一二線先放滿"
    ],
    correct: 1
  },
  {
    question: "航空公司領卡何者正確？",
    options: [
      "需要航空公司主管過來才可以給卡片",
      "航空公司簽名就可以拿一箱卡片了",
      "請組長先來確認",
      "一箱卡換一箱空的"
    ],
    correct: 3
  },
  {
    question: "哪種不需要幫忙拉紅龍？",
    options: [
      "推車的信實",
      "輪椅旅客",
      "救護車",
      "環宇車子"
    ],
    correct: 0
  },
  {
    question: "下列哪個地方需要手檢？",
    options: ["洛杉磯", "仁川", "新加坡", "杜拜"],
    correct: 1
  },
  {
    question: "下列哪個地方需要手檢？",
    options: ["洛杉磯", "名古屋", "胡志明", "日本"],
    correct: 2
  },
  {
    question: "下列哪個地方需要手檢？",
    options: ["香港", "福岡", "神戶", "大阪"],
    correct: 0
  },
  {
    question: "下列哪個國家需要收卡？",
    options: ["曼谷", "福岡", "香港", "浦東"],
    correct: 1
  },
  {
    question: "下列哪個國家需要收卡？",
    options: ["廣州", "澳門", "新加坡", "釜山"],
    correct: 2
  },
  {
    question: "下列哪個國家需要收卡？",
    options: ["杜拜", "澳門", "仁川", "釜山"],
    correct: 0
  },
  {
    question: "中華航空代號是？",
    options: ["MF", "CI", "HX", "JX"],
    correct: 1
  },
  {
    question: "東方航空代號是？",
    options: ["BR", "MF", "MU", "SQ"],
    correct: 2
  },
  {
    question: "華信航空代號是？",
    options: ["AC", "MF", "SQ", "AE"],
    correct: 3
  },
  {
    question: "海南航空代號是？",
    options: ["BE", "UH", "CU", "HU"],
    correct: 3
  },
  {
    question: "如果是尖峰時間（4條線），機組則以抽查優先。需抽查的班機為下列何者？",
    options: ["BR169", "BR2781", "BR62", "BR105"],
    correct: 2
  },
  {
    question: "如果是尖峰時間（4條線），機組則以抽查優先。需抽查的班機為下列何者？",
    options: ["BR105", "BR398", "BR2900", "BR169"],
    correct: 1
  },
  {
    question: "如果是尖峰時間（4條線），機組則以抽查優先。需抽查的班機為下列何者？",
    options: ["BR212", "BR131", "BR169", "BR2900"],
    correct: 0
  },
  {
    question: "如果是尖峰時間（4條線），機組則以抽查優先。需抽查的班機為下列何者？",
    options: ["BR868", "BR153", "BR802", "BR392"],
    correct: 3
  },
  {
    question: "如有看到旅客推手推車，都優先引導至幾線？",
    options: ["1線", "2線", "3線", "4線"],
    correct: 2
  },
  // 新增題目開始
  {
    question: "主分流早上以下哪些行為是錯誤？",
    options: ["清理白色棄置桶", "擦拭分流工作桌子", "查看前導棄置桶", "查看分流密錄器有沒有電量"],
    correct: 2
  },
  {
    question: "假設4線全滿情況「未有收卡」，主分流下列動作是錯誤？",
    options: ["站在前面引導旅客", "呼叫分流2支援", "打開宣導大聲公", "關閉收卡紅龍避免收卡旅客進入"],
    correct: 1
  },
  {
    question: "關於CD區行動電源何者錯誤？",
    options: ["日夜需要交接清楚", "不需要充電及回收", "需要充電及回收", "早上先確認有無電量"],
    correct: 2
  },
  {
    question: "駐外使節人員請問要引導至？",
    options: ["4線", "中間", "紅線", "綠線"],
    correct: 3
  },
  {
    question: "下列分流相關何者錯誤？",
    options: ["手推車優先引導3線", "備勤室消毒水固定A分流補充", "輪椅旅客分流需要幫忙開紅龍", "嬰兒推車走一二線"],
    correct: 1
  },
  {
    question: "下列分流相關何者正確？",
    options: ["旅客有推手推車，要攔住他們叫他們推回去", "收卡「未拿」卡片，請確認過機票，確認後再放綠線並宣導", "低風險旅客「想手檢」，一樣請他走綠線", "手檢旅客身上沒任何行李，一樣放紅線"],
    correct: 1
  },
  {
    question: "南方航空代號是？",
    options: ["ZC", "CA", "CZ", "QZ"],
    correct: 2
  },
  {
    question: "深圳航空代號是？",
    options: ["HZ", "ZH", "CZ", "HX"],
    correct: 1
  },
  {
    question: "釜山航空代號是？",
    options: ["XB", "OZ", "BX", "BR"],
    correct: 2
  },
  {
    question: "下列哪一個並非高風險地區？",
    options: ["曼谷", "馬尼拉", "寧波", "仙台"],
    correct: 3
  }
  ],
"food1": [
    {
    question: "蘋果的英文是？",
    options: ["apple", "april", "ample", "ankle"],
    correct: 0
    },
    {
    question: "泥土的英文是？",
    options: ["boil", "soil", "coil", "foil"],
    correct: 1
    },
    {
    question: "木頭的英文是？",
    options: ["word", "wool", "wood", "world"],
    correct: 2
    },
    {
    question: "雞肉的英文是？",
    options: ["kitchen", "chicken", "children", "chosen"],
    correct: 1
    },
    {
    question: "牛肉的英文是？",
    options: ["beef", "beer", "been", "bear"],
    correct: 0
    },
    {
    question: "豬肉的英文是？",
    options: ["park", "port", "pork", "part"],
    correct: 2
    },
    {
    question: "培根的英文是？",
    options: ["beacon", "bacon", "broken", "bucket"],
    correct: 1
    },
    {
    question: "火腿腸的英文是？",
    options: ["ham sausage", "home storage", "hand savage", "head surface"],
    correct: 0
    },
    {
    question: "三明治的英文是？",
    options: ["sandwich", "sandals", "standard", "sunlight"],
    correct: 0
    },
    {
    question: "漢堡的英文是？",
    options: ["hunger", "hamburger", "hamster", "hammer"],
    correct: 1
    },
    {
    question: "糖果的英文是？",
    options: ["candle", "cancel", "candy", "camera"],
    correct: 2
    },
    {
    question: "生菜的英文是？",
    options: ["letter", "little", "latter", "lettuce"],
    correct: 3
    },
    {
    question: "餅乾的英文是？",
    options: ["cookie", "cooking", "corner", "copper"],
    correct: 0
    },
    {
    question: "水果的英文是？",
    options: ["front", "fruit", "frost", "first"],
    correct: 1
    },
    {
    question: "肉的英文是？",
    options: ["meet", "meal", "meat", "mean"],
    correct: 2
    },
    {
    question: "肉乾的英文是？",
    options: ["jerky", "jacket", "jungle", "junior"],
    correct: 0
    },
    {
    question: "肉製品的英文是？",
    options: ["meat products", "meet problems", "main projects", "most progress"],
    correct: 0
    },
    {
    question: "新鮮的英文是？",
    options: ["flesh", "flash", "fresh", "crash"],
    correct: 2
    },
    {
    question: "肥皂的英文是？",
    options: ["soup", "soap", "shop", "stop"],
    correct: 1
    },
    {
    question: "種子的英文是？",
    options: ["seeds", "needs", "feeds", "deeds"],
    correct: 0
    }
    ],
"food": [
  {
    question: "蘋果的英文是？",
    options: ["apple", "april", "ample", "ankle"],
    correct: 0
  },
  {
    question: "香蕉的英文是？",
    options: ["balance", "banana", "bandana", "bamboo"],
    correct: 1
  },
  {
    question: "葡萄的英文是？",
    options: ["graph", "grasp", "grape", "grace"],
    correct: 2
  },
  {
    question: "鳳梨的英文是？",
    options: ["pineapple", "principle", "pipeline", "pinnacle"],
    correct: 0
  },
  {
    question: "芒果的英文是？",
    options: ["manage", "mango", "manner", "marble"],
    correct: 1
  },
  {
    question: "草莓的英文是？",
    options: ["strategy", "strawberry", "structure", "struggle"],
    correct: 1
  },
  {
    question: "西瓜的英文是？",
    options: ["watermelon", "waterfall", "warehouse", "wardrobe"],
    correct: 0
  },
  {
    question: "檸檬的英文是？",
    options: ["lemon", "melon", "lesson", "legend"],
    correct: 0
  },
  {
    question: "桃子的英文是？",
    options: ["peace", "peach", "pearl", "panel"],
    correct: 1
  },
  {
    question: "櫻桃的英文是？",
    options: ["charity", "chamber", "cherry", "cheese"],
    correct: 2
  },
  {
    question: "奇異果的英文是？",
    options: ["kiwi", "king", "kind", "kick"],
    correct: 0
  },
  {
    question: "梨子的英文是？",
    options: ["pair", "pear", "park", "part"],
    correct: 1
  },
  {
    question: "藍莓的英文是？",
    options: ["blueberry", "blueprint", "bluebird", "bluebell"],
    correct: 0
  },
  {
    question: "木瓜的英文是？",
    options: ["papaya", "parade", "palace", "package"],
    correct: 0
  },
  {
    question: "楊桃的英文是？",
    options: ["starfish", "starfruit", "starlight", "standard"],
    correct: 1
  },
  {
    question: "椰子的英文是？",
    options: ["coconut", "cocoon", "cocktail", "cockpit"],
    correct: 0
  },
  {
    question: "石榴的英文是？",
    options: ["pomegranate", "pomegranite", "pomegranate", "pomegranite"],
    correct: 0
  },
  {
    question: "火龍果的英文是？",
    options: ["dragon fly", "dragon fruit", "dragon boat", "dragon dance"],
    correct: 1
  },
  {
    question: "牛肉的英文是？",
    options: ["beach", "beast", "beard", "beef"],
    correct: 3
  },
  {
    question: "豬肉的英文是？",
    options: ["park", "pork", "port", "post"],
    correct: 1
  },
  {
    question: "雞肉的英文是？",
    options: ["chicken", "kitchen", "children", "chimney"],
    correct: 0
  },
  {
    question: "羊肉的英文是？",
    options: ["lamp", "lamb", "land", "lane"],
    correct: 1
  },
  {
    question: "火腿的英文是？",
    options: ["hand", "hard", "ham", "hat"],
    correct: 2
  },
  {
    question: "香腸的英文是？",
    options: ["sandwich", "sausage", "savage", "saucer"],
    correct: 1
  },
  {
    question: "培根的英文是？",
    options: ["beacon", "become", "bacon", "basket"],
    correct: 2
  },
  {
    question: "火雞肉的英文是？",
    options: ["turkey", "turnip", "turtle", "tunnel"],
    correct: 0
  },
  {
    question: "鴨肉的英文是？",
    options: ["duck", "dust", "dusk", "duty"],
    correct: 0
  },
  {
    question: "鹿肉的英文是？",
    options: ["version", "venison", "veteran", "vessel"],
    correct: 1
  },
  {
    question: "兔肉的英文是？",
    options: ["rabbit", "racket", "radius", "random"],
    correct: 0
  },
  {
    question: "牛排的英文是？",
    options: ["stake", "steak", "steam", "steel"],
    correct: 1
  },
  {
    question: "肉丸的英文是？",
    options: ["meatball", "meetball", "metalball", "medalball"],
    correct: 0
  },
  {
    question: "牛腩的英文是？",
    options: ["bracket", "blanket", "brisket", "bucket"],
    correct: 2
  },
  {
    question: "牛肋排的英文是？",
    options: ["ribs", "rips", "rice", "rich"],
    correct: 0
  },
  {
    question: "豬排的英文是？",
    options: ["pork ship", "pork shop", "pork chip", "pork chop"],
    correct: 3
  },
  {
    question: "雞翅的英文是？",
    options: ["chicken wings", "chicken rings", "chicken kings", "chicken things"],
    correct: 0
  },
  {
    question: "雞胸肉的英文是？",
    options: ["chicken beast", "chicken breast", "chicken best", "chicken blast"],
    correct: 1
  },
  {
    question: "肉鬆的英文是？",
    options: ["pork gloss", "pork floss", "pork cross", "pork gross"],
    correct: 1
  },
  {
    question: "高麗菜的英文是？",
    options: ["garbage", "cabbage", "baggage", "package"],
    correct: 1
  },
  {
    question: "胡蘿蔔的英文是？",
    options: ["carpet", "carbon", "carrot", "carton"],
    correct: 2
  },
  {
    question: "番茄的英文是？",
    options: ["tomato", "tornado", "tobacco", "torpedo"],
    correct: 0
  },
  {
    question: "黃瓜的英文是？",
    options: ["cucumber", "customer", "computer", "culture"],
    correct: 0
  },
  {
    question: "菠菜的英文是？",
    options: ["spinach", "spanish", "speech", "special"],
    correct: 0
  },
  {
    question: "洋蔥的英文是？",
    options: ["ocean", "onion", "option", "organ"],
    correct: 1
  },
  {
    question: "青椒的英文是？",
    options: ["green paper", "green pepper", "green proper", "greenpper"],
    correct: 1
  },
  {
    question: "花椰菜的英文是？",
    options: ["cauliflower", "sunflower", "wallflower", "cornflower"],
    correct: 0
  },
  {
    question: "茄子的英文是？",
    options: ["elephant", "eggplant", "elegant", "element"],
    correct: 1
  },
  {
    question: "地瓜的英文是？",
    options: ["sweet potato", "sweet tomato", "sweet photo", "sweet motto"],
    correct: 0
  },
  {
    question: "糖果的英文是？",
    options: ["candy", "candle", "cancel", "canvas"],
    correct: 0
  },
  {
    question: "肉乾的英文是？",
    options: ["jewel", "jersey", "jelly", "jerky"],
    correct: 3
  },
  {
    question: "種子的英文是？",
    options: ["seems", "seven", "seeds", "sense"],
    correct: 2
  },
  {
    question: "全熟的英文是？",
    options: ["well done", "well gone", "well known", "well worn"],
    correct: 0
  },
  {
    question: "油的英文是？",
    options: ["oil", "owl", "old", "our"],
    correct: 0
  },
  {
    question: "生菜的英文是？",
    options: ["letter", "little", "lettuce", "listen"],
    correct: 2
  },
  {
    question: "往前的英文是？",
    options: ["forward", "toward", "reward", "awkward"],
    correct: 0
  },
  {
    question: "檢查的英文是？",
    options: ["check", "cheek", "chess", "chest"],
    correct: 0
  },
  {
    question: "打開的英文是？",
    options: ["open", "opera", "often", "ocean"],
    correct: 0
  },
  {
    question: "肥皂的英文是？",
    options: ["soap", "soup", "shop", "stop"],
    correct: 0
  },
  {
    question: "衣服的英文是？",
    options: ["clothes", "clouds", "clocks", "clubs"],
    correct: 0
  },
  {
    question: "手機的英文是？",
    options: ["mobile phone", "mobile home", "mobile bone", "mobile zone"],
    correct: 0
  },
  {
    question: "眼鏡的英文是？",
    options: ["grasses", "glasses", "grasses", "masses"],
    correct: 1
  },
  {
    question: "鞋子的英文是？",
    options: ["shoes", "shows", "shops", "shots"],
    correct: 0
  },
  {
    question: "熱狗的英文是？",
    options: ["hot dog", "hot fog", "hot log", "hot hog"],
    correct: 0
  },
  {
    question: "三明治的英文是？",
    options: ["sandwich", "sandwish", "handwich", "bandwich"],
    correct: 0
  },
  {
    question: "餅乾的英文是？",
    options: ["cookie", "cooker", "corner", "copper"],
    correct: 0
  },
  {
    question: "寵物餅乾的英文是？",
    options: ["pet sweet", "pet street", "pet treat", "pet meet"],
    correct: 2
  },
  {
    question: "機票的英文是？",
    options: ["plain ticket", "plane ticket", "plant ticket", "planet ticket"],
    correct: 1
  },
  {
    question: "入境的英文是？",
    options: ["immigration", "imagination", "imitation", "invitation"],
    correct: 0
  },
  {
    question: "出境的英文是？",
    options: ["emigration", "immigration", "education", "examination"],
    correct: 0
  },
  {
    question: "皮夾的英文是？",
    options: ["winter", "water", "wallet", "wonder"],
    correct: 2
  },
  {
    question: "行李的英文是？",
    options: ["leakage", "language", "linkage", "luggage"],
    correct: 3
  },
  {
    question: "花生的英文是？",
    options: ["peanut", "peacock", "peanut", "peasant"],
    correct: 0
  },
  {
    question: "玉米的英文是？",
    options: ["coin", "core", "corn", "cord"],
    correct: 2
  },
  {
    question: "肉製品的英文是？",
    options: ["meat products", "meet products", "neat products", "heat products"],
    correct: 0
  },
  {
    question: "果乾的英文是？",
    options: ["tried fruit", "fried fruit", "dried fruit", "cried fruit"],
    correct: 2
  },
  {
    question: "鮮花的英文是？",
    options: ["fresh flowers", "flesh flowers", "flash flowers", "flush flowers"],
    correct: 0
  },
  {
    question: "葉子的英文是？",
    options: ["leaf", "beef", "deaf", "reef"],
    correct: 0
  },
  {
    question: "紅豆的英文是？",
    options: ["red bean", "red been", "red dean", "red lean"],
    correct: 0
  },
  {
    question: "垃圾桶的英文是？",
    options: ["trash can", "trash van", "trash pan", "trash man"],
    correct: 0
  },
  {
    question: "走道的英文是？",
    options: ["able", "isle", "aisle", "angle"],
    correct: 2
  },
  {
    question: "左轉的英文是？",
    options: ["turn left", "turn lift", "turn loft", "turn lost"],
    correct: 0
  },
  {
    question: "右轉的英文是？",
    options: ["turn sight", "turn light", "turn night", "turn right"],
    correct: 3
  },
  {
    question: "直走的英文是？",
    options: ["go street", "go stream", "go straight", "go strong"],
    correct: 2
  },
  {
    question: "機場的英文是？",
    options: ["airpost", "airpart", "airpot", "airport"],
    correct: 3
  },
  {
    question: "登機口的英文是？",
    options: ["gete", "gate", "hate", "late"],
    correct: 1
  },
  {
    question: "登機證的英文是？",
    options: ["boarding bass", "boarding mass", "boarding pass", "boarding class"],
    correct: 2
  },
  {
    question: "行李箱的英文是？",
    options: ["staircase", "showcase", "briefcase", "suitcase"],
    correct: 3
  },
  {
    question: "托運行李的英文是？",
    options: ["checked baggage", "chicken baggage", "chosen baggage", "changed baggage"],
    correct: 0
  },
  {
    question: "手提行李的英文是？",
    options: ["carry-on luggage", "carry-in luggage", "carry-up luggage", "carry-out luggage"],
    correct: 0
  },
  {
    question: "安檢的英文是？",
    options: ["security check", "security cheek", "security chess", "security chest"],
    correct: 0
  },
  {
    question: "海關的英文是？",
    options: ["costumes", "customers", "customs", "columns"],
    correct: 2
  },
  {
    question: "登機的英文是？",
    options: ["boarding", "boating", "booking", "boxing"],
    correct: 0
  },
  {
    question: "起飛的英文是？",
    options: ["take off", "makeup", "pickup", "backup"],
    correct: 0
  },
  {
    question: "降落的英文是？",
    options: ["landing", "lending", "leading", "loading"],
    correct: 0
  },
  {
    question: "航班的英文是？",
    options: ["flight", "fright", "bright", "light"],
    correct: 0
  },
  {
    question: "登機橋的英文是？",
    options: ["jet bridge", "get bridge", "net bridge", "set bridge"],
    correct: 0
  },
  {
    question: "航空公司的英文是？",
    options: ["hairline", "airline", "outline", "online"],
    correct: 1
  },
  {
    question: "候機室的英文是？",
    options: ["waiting lounge", "waiting lounge", "waiting launch", "waiting lunch"],
    correct: 0
  },
  {
    question: "行李轉盤的英文是？",
    options: ["baggage claim", "baggage clamp", "baggage clam", "baggage clan"],
    correct: 0
  },
  {
    question: "銀行的英文是？",
    options: ["bank", "bark", "back", "bulk"],
    correct: 0
  },
  {
    question: "禁止錄影的英文是？",
    options: ["no video recording", "no video recoding", "no video according", "no video rewarding"],
    correct: 0
  },
  {
    question: "禁止拍攝的英文是？",
    options: ["no photography", "no biography", "no geography", "no typography"],
    correct: 0
  },
  {
    question: "請問有攜帶肉製品嗎?的英文是？",
    options: ["Do you have any meat products?", "Do you have any meet products?", "Do you have any neat products?", "Do you have any heat products?"],
    correct: 0
  },
  {
    question: "卡片回收的英文是？",
    options: ["card reciting", "card recycling", "card receiving", "card recording"],
    correct: 1
  },
  {
    question: "麻煩旁邊稍等的英文是？",
    options: ["Please wait inside", "Please wait outside", "Please wait aside", "Please wait beside"],
    correct: 2
  },
  {
    question: "這個請拿著的英文是？",
    options: ["Please fold this", "Please cold this", "Please told this", "Please hold this"],
    correct: 3
  },
  {
    question: "請問有帶到新鮮水果或是肉製品嗎?的英文是？",
    options: ["Do you have flesh fruit or meet products?", "Do you have fresh fruit or meat products?", "Do you have flash fruit or neat products?", "Do you have fresh fruit or heat products?"],
    correct: 1
  },
  {
    question: "這個是生的還是熟的?的英文是？",
    options: ["Is this row or looked?", "Is this saw or booked?", "Is this raw or cooked?", "Is this law or hooked?"],
    correct: 2
  },
  {
    question: "不好意思，請問您可以移到這邊一下嗎?的英文是？",
    options: ["Excuse me, could you love here?", "Excuse me, could you prove here?", "Excuse me, could you remove here?", "Excuse me, could you move here?"],
    correct: 3
  },
  {
    question: "泥土的英文是？",
    options: ["boil", "soil", "coil", "foil"],
    correct: 1
  },
  {
    question: "木頭的英文是？",
    options: ["word", "wool", "wood", "world"],
    correct: 2
  }
  ],
    "vietnamese": [
    {
      question: "gạo(擾)請問是？",
      options: ["米", "麵", "豆", "麥"],
      correct: 0
    },
    {
      question: "kẹo(ˊㄍ一ㄠ)請問是？",
      options: ["餅乾", "糖果", "蛋糕", "巧克力"],
      correct: 1
    },
    {
      question: "balo(ˊㄅㄚ喽)請問是？",
      options: ["手提包", "後背包", "行李箱", "錢包"],
      correct: 1
    },
    {
      question: "ký tên(ˊㄍ一 ㄉ一ㄢ ㄣ氣)請問是？",
      options: ["寫字", "簽名", "蓋章", "填表"],
      correct: 1
    },
    {
      question: "salad請問是？",
      options: ["湯", "飯", "沙拉", "麵"],
      correct: 2
    },
    {
      question: "hoa quả(花 瓜)請問是？",
      options: ["蔬菜", "水果", "花朵", "種子"],
      correct: 1
    },
    {
      question: "túi xách(dui 誰)請問是？",
      options: ["手提袋", "塑膠袋", "紙袋", "垃圾袋"],
      correct: 0
    },
    {
      question: "Hải sản(孩 商ㄣ)請問是？",
      options: ["肉類", "蔬菜", "海鮮", "水果"],
      correct: 2
    },
    {
      question: "thịt bò(踢 ˊㄅㄡ)請問是？",
      options: ["豬肉", "雞肉", "牛肉", "羊肉"],
      correct: 2
    },
    {
      question: "rau xanh(繞 山)請問是？",
      options: ["紅蘿蔔", "綠色蔬菜", "白蘿蔔", "洋蔥"],
      correct: 1
    },
    {
      question: "kiểm tra(ㄍ一ㄣ 渣)請問是？",
      options: ["檢查", "登記", "申請", "填寫"],
      correct: 0
    },
    {
      question: "tỏi(奪)請問是？",
      options: ["洋蔥", "大蒜", "生薑", "辣椒"],
      correct: 1
    },
    {
      question: "thịt(踢)請問是？",
      options: ["魚", "蛋", "肉", "菜"],
      correct: 2
    },
    {
      question: "trứng gà(存ㄍㄚ)請問是？",
      options: ["鴨蛋", "鵝蛋", "雞蛋", "鵪鶉蛋"],
      correct: 2
    },
    {
      question: "Được rồi(溜走ˋ一)請問是？",
      options: ["不好", "好的", "不行", "等等"],
      correct: 1
    },
    {
      question: "hạt giống(哈宗~)請問是？",
      options: ["種子", "花朵", "葉子", "果實"],
      correct: 0
    },
    {
      question: "thịt gà(踢ㄍㄚ)請問是？",
      options: ["牛肉", "豬肉", "雞肉", "魚肉"],
      correct: 2
    },
    {
      question: "Đi thẳng(哩趟ng)請問是？",
      options: ["左轉", "右轉", "直走", "後退"],
      correct: 2
    },
    {
      question: "thịt khô(踢枯)請問是？",
      options: ["新鮮肉", "肉乾", "冷凍肉", "罐頭肉"],
      correct: 1
    },
    {
      question: "thịt heo(踢ㄏ一ㄡ)請問是？",
      options: ["牛肉", "豬肉", "雞肉", "羊肉"],
      correct: 1
    },
    {
      question: "mở ra(ㄇㄜ渣)請問是？",
      options: ["關閉", "打開", "鎖住", "封住"],
      correct: 1
    }
  ],
    "korean": [
    {
      question: "사탕(沙趟)請問是？",
      options: ["糖果", "餅乾", "巧克力", "蛋糕"],
      correct: 0
    },
    {
      question: "쌀(塞哀)請問是？",
      options: ["麵條", "米飯", "麵包", "餃子"],
      correct: 1
    },
    {
      question: "고기(摳ㄎ一)請問是？",
      options: ["魚", "蛋", "肉", "菜"],
      correct: 2
    },
    {
      question: "육포(油ㄆㄡ)請問是？",
      options: ["肉乾", "魚乾", "果乾", "菜乾"],
      correct: 0
    },
    {
      question: "과일(快一)請問是？",
      options: ["蔬菜", "水果", "肉類", "飲料"],
      correct: 1
    },
    {
      question: "샐러드(仙(台)搂deu)請問是？",
      options: ["湯", "飯", "沙拉", "麵"],
      correct: 2
    },
    {
      question: "씨앗(西阿)請問是？",
      options: ["種子", "花朵", "葉子", "根部"],
      correct: 0
    },
    {
      question: "핸드폰(haen deu pon)請問是？",
      options: ["電腦", "手機", "平板", "相機"],
      correct: 1
    },
    {
      question: "야채(壓切ㄟ)請問是？",
      options: ["水果", "肉類", "蔬菜", "海鮮"],
      correct: 2
    },
    {
      question: "과자(誇佳)請問是？",
      options: ["餅乾", "糖果", "蛋糕", "麵包"],
      correct: 0
    },
    {
      question: "기내식(ㄍ一ㄏ一ㄋㄟ西n)請問是？",
      options: ["機場餐廳", "飛機餐", "免稅商品", "登機證"],
      correct: 1
    },
    {
      question: "여권(油鍋ㄣn)請問是？",
      options: ["機票", "護照", "簽證", "身分證"],
      correct: 1
    },
    {
      question: "계란(ㄎ一ㄝ爛n)請問是？",
      options: ["雞蛋", "鴨蛋", "鵝蛋", "魚卵"],
      correct: 0
    },
    {
      question: "소고기(搜ㄎㄡㄎ一)請問是？",
      options: ["豬肉", "雞肉", "牛肉", "羊肉"],
      correct: 2
    },
    {
      question: "가방(咖棒)請問是？",
      options: ["皮夾", "包包", "帽子", "鞋子"],
      correct: 1
    },
    {
      question: "이것(依Go)請問是？",
      options: ["那個", "這個", "哪個", "什麼"],
      correct: 1
    },
    {
      question: "닭고기(踏ㄎㄡㄎ一)請問是？",
      options: ["牛肉", "豬肉", "雞肉", "魚肉"],
      correct: 2
    },
    {
      question: "반숙계란(潘n書ㄎㄟ爛ㄚn)請問是？",
      options: ["生雞蛋", "半熟蛋", "全熟蛋", "炒蛋"],
      correct: 1
    },
    {
      question: "비행기표(批n ㄏ一n ㄍ一 ㄆ一ㄡ)請問是？",
      options: ["機票", "護照", "登機證", "行李票"],
      correct: 0
    },
    {
      question: "돼지고기(推 機 ㄎㄡ ㄎ一)請問是？",
      options: ["牛肉", "豬肉", "雞肉", "羊肉"],
      correct: 1
    },
    {
      question: "완숙계란(萬n 書ㄎㄟ爛ㄚn)請問是？",
      options: ["生雞蛋", "半熟蛋", "全熟蛋", "水煮蛋"],
      correct: 2
    },
    {
      question: "입국심사(一不新n沙)請問是？",
      options: ["出境檢查", "入境審查", "安全檢查", "海關檢查"],
      correct: 1
    }
  ],
"precheck": [
{
  question: "如有詢問旅客方便檢查確認時，旅客回答不方便檢查時，這時候我們應該？",
  options: [
    "「不好意思，我們機場規定一定要檢查。」不讓旅客離開，避免旅客遭受罰款。",
    "「還麻煩請配合我們檢查行李。」先請旅客配合檢查。",
    "「那如果你裡面有肉製品的話，會罰款好幾萬。」告知旅客罰款價格。",
    "「那請問有檢查過，確定沒有帶到肉類肉製品嗎？」隨即讓旅客離開並通報拒檢。"
  ],
  correct: 3
},
{
  question: "王小姐從日本帶回一盒點心，內含蛋糕、餅乾及肉鬆麵包，下列何者可以入境？",
  options: ["純奶油蛋糕", "肉鬆麵包", "鳳爪", "豬肉餅乾"],
  correct: 0
},
{
  question: "下列何種寵物食品可以合法攜帶入境？",
  options: ["未開封的生食寵物飼料", "含有肉類的寵物零食", "純素寵物餅乾", "自製的寵物鮮食"],
  correct: 2
},
{
  question: "李先生從泰國帶回一些香料，下列何者允許入境？",
  options: ["新鮮檸檬葉", "乾燥八角", "帶根的薑黃", "新鮮蒜頭"],
  correct: 1
},
{
  question: "關於乳製品入境規定，下列敘述何者正確？",
  options: ["開封的UHT牛奶可以入境", "保久乳可以入境", "新鮮的羊奶可以入境", "用保溫瓶裝的鮮奶可以入境"],
  correct: 1
},
{
  question: "下列何種月餅不能攜帶入境？",
  options: ["純綠豆餡月餅", "蛋黃豆沙月餅", "云腿月餅", "純蓮蓉月餅"],
  correct: 2
},
{
  question: "複查俠哥查到旅客有攜帶到鮮花餅，下列何者正確？",
  options: [
    "即使看到外包裝確實寫「玫瑰鮮花餅」，但俠哥依然還要看成分。",
    "看到外包裝寫「玫瑰鮮花餅」，俠哥把鮮花餅放回去，繼續看其他東西。",
    "鮮花餅寫有豬油，所以要扣，不能攜帶。",
    "請旅客到動植物櫃台詢問。"
  ],
  correct: 0
},
{
  question: "小美從韓國帶回泡菜，下列何種泡菜可以入境？",
  options: ["含有海鮮的泡菜", "含有新鮮蘿蔔絲泡菜", "含碎肉的泡菜", "含培根的泡菜"],
  correct: 0
},
{
  question: "以下何種中藥材不得攜帶入境？",
  options: ["枸杞", "鹿茸", "菊花", "紅棗"],
  correct: 1
},
{
  question: "張先生從越南帶回水果類，下列何者可以入境？",
  options: ["新鮮芒果", "裡面吃完的榴槤殼", "經過冷凍的新鮮山竹", "完整包裝的乾果"],
  correct: 3
},
{
  question: "關於蛋製品，下列何者可以入境？",
  options: ["溫泉蛋", "生鹹鴨蛋", "茶葉蛋", "生雞蛋"],
  correct: 2
},
{
  question: "下列何種情況會被檢疫單位處以罰鍰？",
  options: ["誠實申報並丟棄水果", "主動丟棄違規物品", "隱匿未申報的肉製品", "詢問檢疫規定如有並拋棄"],
  correct: 2
},
{
  question: "以下何種食品不能入境？",
  options: ["糖葫蘆", "魚鬆米餅", "蜂蜜果醬", "雲腿餅乾"],
  correct: 3
},
{
  question: "關於種子類產品，下列何者正確？",
  options: ["鹽味生花生可以入境", "發芽的綠豆可以入境", "焦糖烘培向日葵籽可以入境", "決明子用密封袋裝就可以入境"],
  correct: 2
},
{
  question: "下列哪些蛋製品需要特別注意？",
  options: ["茶葉蛋", "茶碗蒸", "荷包蛋", "皮蛋"],
  correct: 3
},
{
  question: "查獲到糖葫蘆如何判斷正確？",
  options: ["可攜帶", "不可攜帶", "需要請旅客去檢疫櫃台詢問", "需要請旅客去檢疫櫃台申報"],
  correct: 0
},
{
  question: "查獲到生米應該請旅客怎麼做？",
  options: [
    "生米不能攜帶，麻煩現場拋棄。",
    "告知旅客去動植物櫃台「申報」。",
    "告知旅客去動植物櫃台「做詢問」。",
    "跟旅客說生米可以帶，但是要去申報。"
  ],
  correct: 2
},
{
  question: "查獲香蕉皮如何判斷正確？",
  options: ["可攜帶", "不可攜帶", "需要請旅客去檢疫櫃台詢問", "需要請旅客去檢疫櫃台申報"],
  correct: 1
},
{
  question: "查獲決明子如何判斷正確？",
  options: ["可攜帶", "不可攜帶", "需要請旅客去檢疫櫃台詢問", "需要請旅客去檢疫櫃台申報"],
  correct: 1
},
{
  question: "查獲乾燥香菇如何判斷正確？",
  options: ["可攜帶", "不可攜帶", "需要請旅客去檢疫櫃台詢問", "需要請旅客去檢疫櫃台申報"],
  correct: 0
},
{
  question: "查獲到無成分稻香村綜合月餅如何判斷正確？",
  options: ["可攜帶", "不可攜帶", "需要請旅客去檢疫櫃台詢問", "需要請旅客去檢疫櫃台申報"],
  correct: 2
},
{
  question: "小明是前導人員，下列哪一項詢問是必要的通關問題？",
  options: [
    "是否攜帶現金超過一萬美金？",
    "是否有帶新鮮水果或含肉類製品的飛機餐或麵包？",
    "是否有購買免稅商品？",
    "是否攜帶筆記型電腦？"
  ],
  correct: 1
},
{
  question: "小芸在執行前導工作時，看到一對夫妻要一起通過黃線，正確處理方式為何？",
  options: [
    "可以允許一起通過。",
    "告知「一位往前，第二位麻煩黃線後稍等」。",
    "請他們走特殊通道。",
    "視現場人潮決定。"
  ],
  correct: 1
},
{
  question: "前導小徐收到低風險疫區卡片的旅客後，應該如何處理？",
  options: [
    "請旅客過X光機檢查。",
    "收取卡片後請旅客直接往前，並告知前面人員「旅客已收卡」。",
    "請旅客等待其他人一起通過。",
    "要求旅客出示護照確認。"
  ],
  correct: 1
},
{
  question: "小徐遇到旅客拒絕檢查時，首要處理方式為何？",
  options: [
    "直接強制檢查。",
    "通報主管處理。",
    "詢問是否有確認無攜帶到含肉類製品或新鮮水果、發芽種子。",
    "請旅客離開。"
  ],
  correct: 2
},
{
  question: "阿郎在處理檢疫物時，下列何者正確？",
  options: ["直接丟入一般垃圾桶", "要確實分類並破壞包裝", "集中存放後統一處理", "請旅客自行處理"],
  correct: 1
},
{
  question: "小明在檢查無成分食物時，旅客很肯定無肉製品，正確的做法為何？",
  options: [
    "直接剝開檢查內容物。",
    "再次警告旅客，如果下面發現有肉罰款20萬。",
    "與旅客確認成分並告知宣導即可，必要時給予宣導單。",
    "要求旅客撥開徹底檢查。"
  ],
  correct: 2
},
{
  question: "阿樺遇到旅客攜帶電動行李車時，應如何處理？",
  options: [
    "請旅客帶著電動車往前，不過X光機，需前往手檢。",
    "請旅客過X光機。",
    "直接放行。",
    "要求旅客寄存。"
  ],
  correct: 0
},
// 新增題目開始
{
  question: "「乾羅漢果」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 1
},
{
  question: "「鹿茸粉」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 0
},
{
  question: "「沒有成份的餅」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 2
},
{
  question: "「八角」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 1
},
{
  question: "「外包裝有寫UHT的香腸」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 0
},
{
  question: "「吃進嘴巴裡的檳榔」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 0
},
{
  question: "「流心蛋黃酥」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 1
},
{
  question: "「生魚片」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 1
},
{
  question: "「蕎麥粉」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 1
},
{
  question: "「120度2秒殺菌的真空肉乾」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 0
},
{
  question: "「海藻面膜」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 0
},
{
  question: "「完整的草莓大福」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 1
},
{
  question: "「決明子」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 0
},
{
  question: "「乾檳榔」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 1
},
{
  question: "「台灣買的檳榔」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 0
},
{
  question: "「雞內金脆片」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 2
},
{
  question: "「酸奶」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 1
},
{
  question: "「鵝肝醬」請選出正確答案？",
  options: ["檢疫物", "非檢疫物", "需至檢疫櫃檯"],
  correct: 2
},
{
  question: "請問哪一個位置是回收檢疫物？",
  options: ["3-1", "4-2", "4-1", "2-1"],
  correct: 2
},
{
  question: "請問循環扇遙控器固定放在哪個地方？",
  options: ["1線盒子", "2線盒子", "3線盒子", "4線盒子"],
  correct: 3
},
{
  question: "噴消毒毯方向？",
  options: ["面向走來的入境旅客", "不分方向", "背向走來的入境旅客", "側向走來的入境旅客"],
  correct: 0
},
{
  question: "前導遇到輪椅旅客請問等待人數要多少才接？",
  options: ["中間輪椅人數多少，等待人數X1", "中間輪椅人數多少，等待人數X2", "中間輪椅人數多少，等待人數X3", "中間輪椅人數多少，等待人數X4"],
  correct: 2
}
  ],
  "rule": [
    {
      question: "1. 請問「選休」何者正確？",
      options: [
        "如果當日有狀況，需要配合上班。",
        "小明選擇10號休，就一定排得到那天。",
        "如果當日太多人排同一天，就會以抽籤決定。",
        "給主管選假的意思。"
      ],
      correct: 2
    },
    {
      question: "2. 請問「預排」何者正確？",
      options: [
        "因人手還夠，主管預排假給你，但有狀況時需要等待通知，並支援上班。",
        "10號遇到排班，那天剛好跟朋友有約，答應對方。",
        "明天被放假，手機先關機就沒問題。",
        "預排就是多給你的「選休」。"
      ],
      correct: 0
    },
    {
      question: "3. 請問廁所的代號是什麼？",
      options: [
        "兩59",
        "兩65",
        "兩95",
        "95兩"
      ],
      correct: 2
    },
    {
      question: "4. 備勤室私人物品，下列何者正確？",
      options: [
        "上下班請勿亂放私人物品在桌面上，如真的太多，請放鐵架上沒關係。",
        "私人物品請勿亂放（尤其下班時），桌面要清空，椅子要歸位。",
        "椅子未歸位者，輪值分流2一天。",
        "下班後任何背包請放置物鐵架，不要都放在桌子上。"
      ],
      correct: 1
    },
    {
      question: "5. 看到旅客跌倒時，應該通報？",
      options: [
        "61959",
        "69991",
        "51999",
        "61999"
      ],
      correct: 3
    },
    {
      question: "6. 對講機「X光」代號？",
      options: [
        "洞倆",
        "洞么",
        "洞3",
        "洞6"
      ],
      correct: 0
    },
    {
      question: "7. 對講機「組長」代號？",
      options: [
        "洞3",
        "洞么",
        "洞7",
        "洞6"
      ],
      correct: 3
    },
    {
      question: "8. 對講機「代理組長」代號？",
      options: [
        "洞3",
        "洞么",
        "洞7",
        "洞6"
      ],
      correct: 3
    },
    {
      question: "9. 當看到旅客受傷時，下列何者錯誤？",
      options: [
        "立馬上前關心，詢問是否需要協助。",
        "立即完成手邊的複查工作後再做詢問。",
        "觀察旅客情況，必要時請通報。",
        "旅客當下可能需要休息，拿椅子先讓旅客坐著休息。"
      ],
      correct: 1
    },
    {
      question: "10. 關於冰箱，下列何者錯誤？",
      options: [
        "日期為2天為限",
        "必須寫上名字與當天日期",
        "日期為3天為限",
        "如超過時間會通知，沒人認領下班後會丟棄"
      ],
      correct: 2
    },
    {
      question: "11. 遺失通行證費用如何？",
      options: [
        "200元",
        "2000元",
        "1000元",
        "要寫檢討單"
      ],
      correct: 1
    },
    {
      question: "12. 微波爐使用方式，哪個錯誤？",
      options: [
        "微波便當請直接蓋子打開放進去微波就好",
        "打開的便當請用衛生紙覆蓋",
        "使用完必須是歸0狀態才打開，切勿直接打開",
        "只要是有殼、皮和膜，都是不能直接微波的食材"
      ],
      correct: 0
    },
    {
      question: "13. 關於管制區免稅店，下列何者錯誤？",
      options: [
        "經過免稅店，外面看看就好，不能進去",
        "可以進去詢問店員東西",
        "任何免稅店都不能進去",
        "放假出國非上班時段是旅客，所以不影響，是可以進去的"
      ],
      correct: 1
    },
    {
      question: "14. 關於消毒毯工作是給哪個位置負責？",
      options: [
        "4線前導",
        "4線複查1",
        "4線複查2",
        "3線複查2"
      ],
      correct: 2
    },
    {
      question: "15. 請問回報手機是給哪個位置負責？",
      options: [
        "1線前導",
        "1線複查2",
        "1線複查1",
        "4線複查2"
      ],
      correct: 1
    },
    {
      question: "16. 請問管理百寶袋是給哪個位置負責？",
      options: [
        "1線前導",
        "1線複查2",
        "1線複查1",
        "4線複查2"
      ],
      correct: 2
    },
    {
      question: "17. 請問清點交接密錄器是哪個位置負責？",
      options: [
        "1線前導",
        "1線複查2",
        "2線複查2",
        "4線複查2"
      ],
      correct: 2
    },
    {
      question: "18. 任何要給的資料一律什麼時候給？",
      options: [
        "下午2點前",
        "當日下班以前都可以交",
        "3天以內上班交都可以",
        "下午3點前"
      ],
      correct: 3
    },
    {
      question: "19. 關於脫換背心哪個正確？",
      options: [
        "同仁可以穿背心，A哨如果有決定穿，A哨全部都要穿",
        "如果旅客多了變熱了，前導小華可以先把背心脫掉",
        "脫換背心一律A、B、C哨各別決定",
        "脫換背心一律全部上哨同仁都要一樣"
      ],
      correct: 3
    },
    {
      question: "20. 消毒毯時間下列何者正確？",
      options: [
        "16:30",
        "15:30",
        "12:35",
        "15:00"
      ],
      correct: 0
    }
  ]
};

// 考試配置 - 修正題庫引用
const examConfigs = {
  'basic': {
      name: '分流考試挑戰',                    // 考試名稱
      timePerQuestion: 60,                     // 每題時間限制
      questionCount: 10,                       // 考試總題數
      fastAnswerThreshold: 5,                  // 快速答題門檻
      questions: examQuestions['basic']        // 題庫來源
  },
  'food1': {
      name: '⭐英文考試基礎版⭐',                // 考試名稱
      timePerQuestion: 15,                      // 每題時間限制
      questionCount: 15,                       // 考試總題數
      fastAnswerThreshold: 2.5,                // 快速答題門檻
      questions: examQuestions['food1']         // 題庫來源
  },
  'food': {
      name: '⭐英文考試進階版⭐',                // 考試名稱
      timePerQuestion: 10,                      // 每題時間限制
      questionCount: 20,                       // 考試總題數
      fastAnswerThreshold: 2,                // 快速答題門檻
      questions: examQuestions['food']         // 題庫來源
  },
  'precheck': {
      name: '前導複查挑戰',                    // 考試名稱
      timePerQuestion: 60,                     // 每題時間限制
      questionCount: 15,                       // 考試總題數
      fastAnswerThreshold: 5,                // 快速答題門檻
      questions: examQuestions['precheck']     // 題庫來源
  },
  'rule': {
      name: '規定挑戰',                        // 考試名稱
      timePerQuestion: 60,                     // 每題時間限制
      questionCount: 10,                       // 考試總題數
      fastAnswerThreshold: 5,                // 快速答題門檻
      questions: examQuestions['rule']         // 題庫來源
  },
  'korean': {
    name: '🇰🇷韓語挑戰基礎版🇰🇷',
    timePerQuestion: 12,                      // 每題12秒
    questionCount: 15,                        // 考試總題數
    fastAnswerThreshold: 3,                   // 快速答題門檻
    questions: examQuestions['korean']        // 題庫來源
  },
  'vietnamese': {
    name: '🇻🇳越南語詞彙挑戰🇻🇳',
    timePerQuestion: 12,                      // 每題12秒
    questionCount: 15,                        // 考試總題數
    fastAnswerThreshold: 3,                   // 快速答題門檻
    questions: examQuestions['vietnamese']    // 題庫來源
  },
  'sudoku': {
      name: '初階數獨挑戰',                    // 考試名稱
      timePerQuestion: 80,                     // 每題時間限制
      questionCount: 5,                        // 考試總題數
      fastAnswerThreshold: 30,                 // 快速答題門檻
      questions: []                            // 題庫來源（動態生成）
  }
};

// 🔧 修正版數獨生成函數
function generateSudoku() {
  // 創建基礎解答
const solution = [
    [1, 2, 3, 4],
    [3, 4, 1, 2],
    [2, 1, 4, 3],
    [4, 3, 2, 1]
];

// 隨機打亂行和列
for (let i = 0; i < 5; i++) {
    // 隨機交換行
    const row1 = Math.floor(Math.random() * 4);
    const row2 = Math.floor(Math.random() * 4);
    [solution[row1], solution[row2]] = [solution[row2], solution[row1]];
    
    // 隨機交換列
    const col1 = Math.floor(Math.random() * 4);
    const col2 = Math.floor(Math.random() * 4);
    for (let row = 0; row < 4; row++) {
        [solution[row][col1], solution[row][col2]] = [solution[row][col2], solution[row][col1]];
    }
}

// 創建題目（移除一些數字）
const puzzle = solution.map(row => [...row]);
const cellsToRemove = 8; // 移除8個數字，留下8個

for (let i = 0; i < cellsToRemove; i++) {
    let row, col;
    do {
        row = Math.floor(Math.random() * 4);
        col = Math.floor(Math.random() * 4);
    } while (puzzle[row][col] === 0);
    puzzle[row][col] = 0;
}

return { puzzle, solution };
}

// 檢查數獨答案是否正確
function checkSudokuAnswer(userAnswer, solution) {
for (let i = 0; i < 4; i++) {
    for (let j = 0; j < 4; j++) {
        if (parseInt(userAnswer[i][j]) !== solution[i][j]) {
            return false;
        }
    }
}
return true;
}

// 生成數獨題目
function generateSudokuQuestions() {
const questions = [];
for (let i = 0; i < 5; i++) {
    const { puzzle, solution } = generateSudoku();
    questions.push({
        question: `數獨題目 ${i + 1}`,
        puzzle: puzzle,
        solution: solution,
        type: 'sudoku'
    });
}
return questions;
}

// 🔧 修正版開始考試函數 - 關鍵修正！
function startExam(examType) {
if (!currentUser) {
    alert('請先登入');
    return;
}

const config = examConfigs[examType];
if (!config) {
    alert('考試類型不存在');
    return;
}

// 清除任何現有的計時器
if (examTimer) {
    clearInterval(examTimer);
    examTimer = null;
}

currentExam = examType;
currentQuestionIndex = 0;
userScores = {
    fastAnswers: 0,
    correctAnswers: 0
};

// 準備題目
if (examType === 'sudoku') {
    currentQuestions = generateSudokuQuestions();
} else {
    // 隨機選取題目
    const allQuestions = [...config.questions];
    currentQuestions = [];
    for (let i = 0; i < config.questionCount; i++) {
        if (allQuestions.length === 0) break;
        const randomIndex = Math.floor(Math.random() * allQuestions.length);
        currentQuestions.push(allQuestions[randomIndex]);
        allQuestions.splice(randomIndex, 1);
    }
}

showExamInterface();
showQuestion();
}

// 🔧 修正版顯示考試界面 - 關鍵修正！
function showExamInterface() {
    // 修正：直接選擇 mainContent 而不是 .container
    const container = document.getElementById('mainContent');
    container.innerHTML = `
        <div class="exam-container">
            <div class="exam-header">
                <h2>${examConfigs[currentExam].name}</h2>
                <div class="timer" id="timer">00:00</div>
            </div>
            <div id="questionContainer"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-danger" onclick="abandonExam()" style="background: #dc3545;">🚪 放棄考試</button>
            </div>
        </div>
    `;
}

// 放棄考試
function abandonExam() {
    // 清除計時器
    if (examTimer) {
        clearInterval(examTimer);
        examTimer = null;
    }
    
    // 確認對話框
    const confirmed = confirm('🤔 確定要放棄考試嗎？\n\n⚠️ 放棄後將不會保存任何成績！');
    
    if (confirmed) {
        alert('😔 考試已放棄，返回主頁面');
        // 🔧 修正：重新載入頁面回到主畫面
        location.reload();
    } else {
        // 如果取消，重新開始計時
        startQuestionTimer();
    }
}

// 顯示題目函數
function showQuestion() {
// 清除現有計時器
if (examTimer) {
    clearInterval(examTimer);
    examTimer = null;
}

const config = examConfigs[currentExam];
const question = currentQuestions[currentQuestionIndex];
const container = document.getElementById('questionContainer');

questionStartTime = Date.now();

if (question.type === 'sudoku') {
    // 數獨題目
    container.innerHTML = `
        <div class="question">
            <h3>第 ${currentQuestionIndex + 1} 題 / ${currentQuestions.length}</h3>
            <p>${question.question}</p>
            <div class="sudoku-grid" id="sudokuGrid"></div>
            <button class="btn btn-primary" onclick="submitSudokuAnswer()">提交答案</button>
            <button class="btn btn-danger" onclick="skipQuestion()">跳過</button>
        </div>
    `;
    
    // 生成數獨網格
    const grid = document.getElementById('sudokuGrid');
    for (let i = 0; i < 4; i++) {
        for (let j = 0; j < 4; j++) {
            const cell = document.createElement('input');
            cell.type = 'number';
            cell.className = 'sudoku-cell';
            cell.min = '1';
            cell.max = '4';
            cell.dataset.row = i;
            cell.dataset.col = j;
            
            if (question.puzzle[i][j] !== 0) {
                cell.value = question.puzzle[i][j];
                cell.disabled = true;
            }
            
            grid.appendChild(cell);
        }
    }
} else {
// 選擇題 - 打亂選項順序
const shuffledOptions = [...question.options];
const correctOption = shuffledOptions[question.correct];

// Fisher-Yates 洗牌算法
for (let i = shuffledOptions.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
}

// 找到正確答案在新順序中的位置
const newCorrectIndex = shuffledOptions.indexOf(correctOption);

container.innerHTML = `
    <div class="question">
        <h3>第 ${currentQuestionIndex + 1} 題 / ${currentQuestions.length}</h3>
        <p>${question.question}</p>
        <div class="options">
            ${shuffledOptions.map((option, index) => 
                `<button class="btn btn-primary option-btn" onclick="selectAnswer(${index}, ${newCorrectIndex})">${option}</button>`
            ).join('')}
        </div>
    </div>
`;

}

// 開始計時
startQuestionTimer();
}


// 計時器函數
function startQuestionTimer() {
    const config = examConfigs[currentExam];
    let timeLeft = config.timePerQuestion;

    const timerElement = document.getElementById('timer');
    if (!timerElement) return;

    examTimer = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
            clearInterval(examTimer);
            examTimer = null;
            timeUp();
            return;
        }
        timeLeft--;
    }, 1000);
}

// 選擇答案
function selectAnswer(selectedIndex, correctIndex = null) {
    if (examTimer) {
        clearInterval(examTimer);
        examTimer = null;
    }

    const question = currentQuestions[currentQuestionIndex];
    const config = examConfigs[currentExam];
    const answerTime = (Date.now() - questionStartTime) / 1000;

    // 如果有傳入 correctIndex 參數（打亂選項的情況），使用它；否則使用原本的邏輯
    const actualCorrectIndex = correctIndex !== null ? correctIndex : question.correct;
    const isCorrect = selectedIndex === actualCorrectIndex;
    const isFast = answerTime <= config.fastAnswerThreshold;

    // 顯示答案反饋
    showAnswerFeedback(selectedIndex, actualCorrectIndex, isCorrect);

    setTimeout(() => {
        nextQuestion();
    }, 2000);
}

// 提交數獨答案
function submitSudokuAnswer() {
    if (examTimer) {
        clearInterval(examTimer);
        examTimer = null;
    }

    const question = currentQuestions[currentQuestionIndex];
    const config = examConfigs[currentExam];
    const answerTime = (Date.now() - questionStartTime) / 1000;

    // 收集用戶答案
    const userAnswer = Array(4).fill().map(() => Array(4).fill(0));
    const cells = document.querySelectorAll('.sudoku-cell');

    cells.forEach(cell => {
        const row = parseInt(cell.dataset.row);
        const col = parseInt(cell.dataset.col);
        const value = parseInt(cell.value) || 0;
        userAnswer[row][col] = value;
    });

    const isCorrect = checkSudokuAnswer(userAnswer, question.solution);
    const isFast = answerTime <= config.fastAnswerThreshold;

    if (isCorrect) {
        userScores.correctAnswers++;
    }
    if (isFast && isCorrect) {
        userScores.fastAnswers++;
    }

    // 顯示結果
    const container = document.getElementById('questionContainer');
    container.innerHTML = `
        <div class="question">
            <h3>${isCorrect ? '✅ 正確！' : '❌ 錯誤！'}</h3>
            <p>用時：${answerTime.toFixed(1)}秒</p>
            ${!isCorrect ? '<p>正確答案已顯示在網格中</p>' : ''}
            <div class="sudoku-grid" id="resultGrid"></div>
        </div>
    `;

    // 顯示正確答案
    const resultGrid = document.getElementById('resultGrid');
    for (let i = 0; i < 4; i++) {
        for (let j = 0; j < 4; j++) {
            const cell = document.createElement('input');
            cell.type = 'number';
            cell.className = 'sudoku-cell';
            cell.value = question.solution[i][j];
            cell.disabled = true;
            resultGrid.appendChild(cell);
        }
    }

    setTimeout(() => {
        nextQuestion();
    }, 3000);
}

// 跳過題目
function skipQuestion() {
    if (examTimer) {
        clearInterval(examTimer);
        examTimer = null;
    }
    nextQuestion();
}

// 時間到
function timeUp() {
    alert('⏰ 時間到！');
    nextQuestion();
}

// 顯示答案反饋
function showAnswerFeedback(selectedIndex, correctIndex, isCorrect) {
    const options = document.querySelectorAll('.option-btn');
    options.forEach((btn, index) => {
        btn.disabled = true;
        if (index === correctIndex) {
            btn.classList.add('correct');
        } else if (index === selectedIndex && !isCorrect) {
            btn.classList.add('wrong');
        }
    });
}

// 下一題
function nextQuestion() {
    currentQuestionIndex++;

    if (currentQuestionIndex >= currentQuestions.length) {
        finishExam();
    } else {
        showQuestion();
    }
}

// 修改完成考試函數，自動保存並避免重複
async function finishExam() {
    if (examTimer) {
        clearInterval(examTimer);
        examTimer = null;
    }

    const config = examConfigs[currentExam];
    const totalQuestions = currentQuestions.length;
    const correctRate = (userScores.correctAnswers / totalQuestions * 100).toFixed(1);
    const fastRate = (userScores.fastAnswers / totalQuestions * 100).toFixed(1);

    // 計算分數
    const baseScore = userScores.correctAnswers * 10;
    const fastBonus = userScores.fastAnswers * 5;
    const totalScore = baseScore + fastBonus;

    // 🔧 自動保存成績（避免重複）
    await autoSaveScore(totalScore);

    // 顯示結果（移除手動保存按鈕）
    const container = document.getElementById('mainContent');
    container.innerHTML = `
        <div class="exam-result">
            <h2>🎉 考試完成！</h2>
            <p>考試類型：${config.name}</p>
            <p>正確題數：${userScores.correctAnswers} / ${totalQuestions}</p>
            <p>正確率：${correctRate}%</p>
            <p>快速答題：${userScores.fastAnswers} 題</p>
            <p>快速答題率：${fastRate}%</p>
            <p><strong>總分：${totalScore} 分</strong></p>
            <p style="color: #22c55e;">✅ 成績已自動保存！</p>
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="restartExam()">🔄 重新考試</button>
                <button class="btn btn-primary" onclick="showLeaderboard('${currentExam}')">📊 查看排行榜</button>
                <button class="btn btn-danger" onclick="backToMain()">🏠 返回主頁</button>
            </div>
        </div>
    `;
}

// 🔧 新增：自動保存成績（避免同用戶重複）
async function autoSaveScore(score) {
    try {
        const timestamp = Date.now();
        const scoreData = {
            username: currentUser.username,
            displayName: currentUser._comment || currentUser.username,
            score: score,
            examType: currentExam,
            timestamp: timestamp,
            correctAnswers: userScores.correctAnswers,
            fastAnswers: userScores.fastAnswers,
            totalQuestions: currentQuestions.length
        };
        
        // 🔧 使用用戶名作為 key，避免重複
        await database.ref(`scores/${currentExam}/${currentUser.username}`).set(scoreData);
        console.log('✅ 成績已自動保存！');
        
        // 🏆 保存後重新載入榜首資訊
        await loadAllChampions();
        
    } catch (error) {
        console.error('自動保存成績失敗:', error);
        alert('❌ 保存成績失敗，請稍後再試');
    }
}

// 保存成績（保留原函數，以防其他地方使用）
async function saveScore(score) {
    try {
        const timestamp = Date.now();
        const scoreData = {
            username: currentUser.username,
            displayName: currentUser._comment || currentUser.username,
            score: score,
            examType: currentExam,
            timestamp: timestamp,
            correctAnswers: userScores.correctAnswers,
            fastAnswers: userScores.fastAnswers,
            totalQuestions: currentQuestions.length
        };
        
        await database.ref(`scores/${currentExam}/${timestamp}`).set(scoreData);
        alert('✅ 成績已保存！');
        
    } catch (error) {
        console.error('保存成績失敗:', error);
        alert('❌ 保存成績失敗，請稍後再試');
    }
}

// 重新考試
function restartExam() {
    startExam(currentExam);
}

// 返回主頁
function backToMain() {
    location.reload();
}

// 🔧 顯示排行榜 - 修正同分排序
async function showLeaderboard(examType) {
    try {
        // 🔧 修正：取得所有成績，不限制數量以正確處理同分
        const snapshot = await database.ref(`scores/${examType}`).once('value');
        const scores = [];
        
        snapshot.forEach(child => {
            scores.push(child.val());
        });
        
        // 🏆 排序邏輯：分數高到低，同分時首綁優先（時間戳早的在前）
        scores.sort((a, b) => {
            if (b.score !== a.score) {
                return b.score - a.score; // 分數高的在前
            }
            return a.timestamp - b.timestamp; // 同分時，時間早的在前（首綁）
        });
        
        // 只取前30名顯示
        const topScores = scores.slice(0, 30);
        
        const modalTitle = document.getElementById('modalTitle');
        const leaderboardContent = document.getElementById('leaderboardContent');
        
        modalTitle.textContent = `${examConfigs[examType].name} - 排行榜`;
        
        if (topScores.length === 0) {
            leaderboardContent.innerHTML = '<div class="empty-leaderboard">暫無成績記錄</div>';
        } else {
            leaderboardContent.innerHTML = `
                <div class="leaderboard-container">
                    ${topScores.map((score, index) => {
              // 🏆 檢查是否為首綁（只有第一名且同分時才顯示）
              const isFirstPlace = index === 0; // 是否為第一名
              const sameScoreCount = scores.filter(s => s.score === score.score).length;
              const isFirstBind = isFirstPlace && sameScoreCount > 1; // 只有第一名且有同分才顯示首綁
              const bindStatus = isFirstBind ? ' 🥇' : '';                
                        return `
                            <div class="leaderboard-item ${score.username === currentUser.username ? 'current-user' : ''}">
                                <span class="rank">#${index + 1}</span>
                                <span class="user-name">${score.displayName}${bindStatus}</span>
                                <span class="score">${score.score}分</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }
        
        document.getElementById('leaderboardModal').style.display = 'flex';
        
    } catch (error) {
        console.error('載入排行榜失敗:', error);
        alert('❌ 載入排行榜失敗，請稍後再試');
    }
}

// 隱藏排行榜
function hideLeaderboard() {
    document.getElementById('leaderboardModal').style.display = 'none';
}

// 🏆 新增：載入所有榜首資訊 - 修正同分處理
async function loadAllChampions() {
    const examTypes = ['basic', 'food1', 'food', 'precheck', 'rule', 'korean', 'vietnamese', 'sudoku'];
    const champions = {};
    
    try {
        for (const examType of examTypes) {
            // 🔧 修正：取得所有成績並進行排序
            const snapshot = await database.ref(`scores/${examType}`).once('value');
            const scores = [];
            
            snapshot.forEach(child => {
                scores.push(child.val());
            });
            
            if (scores.length > 0) {
                // 🏆 排序邏輯：
                // 1. 分數高到低
                // 2. 同分時，時間戳早到晚 (首綁優先)
                scores.sort((a, b) => {
                    if (b.score !== a.score) {
                        return b.score - a.score; // 分數高的在前
                    }
                    return a.timestamp - b.timestamp; // 同分時，時間早的在前（首綁）
                });
                
            // 取得榜首
            const champion = scores[0];
            const sameScoreCount = scores.filter(s => s.score === champion.score).length;
            champions[examType] = {
                displayName: champion.displayName,
                score: champion.score,
                timestamp: champion.timestamp,
                hasMultipleSameScore: sameScoreCount > 1  // 檢查是否有同分
            };
                
                console.log(`🏆 ${examType} 榜首: ${champion.displayName} (${champion.score}分) - 首綁時間: ${new Date(champion.timestamp).toLocaleString()}`);
            }
        }
        
        // 更新頁面顯示
        updateChampionDisplay(champions);
        
    } catch (error) {
        console.error('載入榜首資訊失敗:', error);
    }
}

// 🏆 更新榜首顯示 - 加入首綁標記
function updateChampionDisplay(champions) {
    const challengeItems = document.querySelectorAll('.challenge-item');
    
    challengeItems.forEach(item => {
        const title = item.querySelector('.challenge-title');
        const actions = item.querySelector('.challenge-actions');
        
        // 根據標題判斷考試類型
        let examType = '';
        if (title.textContent.includes('分流考試挑戰')) examType = 'basic';
        else if (title.textContent.includes('⭐英文考試基礎版⭐')) examType = 'food1';
        else if (title.textContent.includes('⭐英文考試進階版⭐')) examType = 'food';
        else if (title.textContent.includes('⭐前導複查挑戰⭐')) examType = 'precheck';
        else if (title.textContent.includes('規定挑戰')) examType = 'rule';
        else if (title.textContent.includes('🇰🇷韓語挑戰基礎版🇰🇷')) examType = 'korean';
        else if (title.textContent.includes('🇻🇳越南語詞彙挑戰🇻🇳')) examType = 'vietnamese';
        else if (title.textContent.includes('初階數獨挑戰')) examType = 'sudoku';
        
        // 如果有榜首資訊，添加顯示
        if (examType && champions[examType]) {
            // 檢查是否已經有榜首顯示，避免重複添加
            let championDiv = item.querySelector('.champion-display');
            if (!championDiv) {
                championDiv = document.createElement('div');
                championDiv.className = 'champion-display';
                // 插入到 challenge-actions 之前
                item.insertBefore(championDiv, actions);
            }
            
            // 🏆 加入首綁標記和時間顯示
            const champion = champions[examType];
            const bindDate = new Date(champion.timestamp).toLocaleDateString();
            
        // 🏆 檢查是否真的有同分才顯示首綁標記
        const bindMark = champion.hasMultipleSameScore ? ' 🥇' : '';

        championDiv.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: space-between; 
                    background: linear-gradient(45deg, #FFD700, #FFA500); 
                    color: #000; padding: 6px 12px; border-radius: 6px; 
                    font-size: 0.85rem; font-weight: bold; margin-bottom: 8px;
                    box-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);">
                <span>🏆 榜首：${champion.displayName}${bindMark}</span>
                <div style="text-align: right;">
                    <div>${champion.score}分</div>
                    <div style="font-size: 0.7rem; opacity: 0.8;">${champion.hasMultipleSameScore ? '首綁 ' : ''}${bindDate}</div>
                </div>
            </div>
        `;
        } else if (examType) {
            // 如果沒有榜首資訊，顯示空榜首
            let championDiv = item.querySelector('.champion-display');
            if (!championDiv) {
                championDiv = document.createElement('div');
                championDiv.className = 'champion-display';
                item.insertBefore(championDiv, actions);
            }
            
            championDiv.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; 
                           background: rgba(255, 255, 255, 0.1); 
                           color: #a0a0a0; padding: 6px 12px; border-radius: 6px; 
                           font-size: 0.85rem; margin-bottom: 8px;
                           border: 1px dashed rgba(255, 255, 255, 0.2);">
                    <span>🏆 暫無榜首</span>
                </div>
            `;
        }
    });
}

// 登出
function logout() {
    localStorage.removeItem('t2_login');
    localStorage.removeItem('t2_login_time');
    localStorage.removeItem('t2_login_user');
    window.location.href = 'index.html';
}

// 返回T2日
function backToT2() {
    window.location.href = 'page3.html';
}

// 頁面載入時初始化
window.addEventListener('load', initializePage);

// 點擊模態視窗外部關閉
document.addEventListener('click', function(event) {
    const modal = document.getElementById('leaderboardModal');
    if (event.target === modal) {
        hideLeaderboard();
    }
});
</script>
</body>
</html>

<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>T2日動植物檢疫登入系統</title>
  <style>
    :root {
        --brand: #4b4e8a;
        --bg: #f4f5fa;
        --card: #ffffff;
        --muted: #a3a6b3;
        --input: #e9ecf4;
        --radius: 16px;
        --title-size: 23px;
        --tip-size: 15px;
        --input-width: 95%;
        --input-height: 41px;
        --btn-height: 47px;
    }

    body{
      margin:0; height:100%;
      display:flex; align-items:center; justify-content:center;
      background:#555;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,"Noto Sans TC","PingFang TC","Helvetica Neue",Arial,"Microsoft JhengHei",sans-serif;
    }
    .phone {
        width: min(420px, 94vw);
        background: var(--card);
        border-radius: 28px;
        box-shadow: 0 6px 22px rgba(0,0,0,.25);
        padding: 141px 15px 146px;
    }

    .title-row {
        display: flex;
        justify-content: center;
        gap: 10px;
        color: var(--brand);
        font-weight: 800;
        font-size: var(--title-size);
        margin: -55px 18px 54px;
        text-align: center;
        align-items: center;
    }

    .title-row img{width:22px;height:22px;}

    /* 提醒列 */
    .tip-row {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #c8cce1;
        border-radius: 12px;
        padding: 12px 14px;
        margin: 6px 6px 18px;
        color: #2f3161;
        font-weight: 700;
        font-size: var(--tip-size);
        justify-content: center;
    }
    .tip-row img{width:20px;height:20px;}

    /* 輸入框 */
    .field {
        background: var(--input);
        border-radius: 14px;
        margin: 7px auto;
        display: flex;
        align-items: center;
        justify-content: center;
        width: var(--input-width);
        height: var(--input-height);
        padding: -1px 12px;
    }
    .field input {
        border: none;
        outline: none;
        background: transparent;
        width: 100%;
        height: 100%;
        font-size: 17px;

        padding-left: 8px;  /* ✅ 輸入文字與placeholder向右縮排 */
    }
    .field input::placeholder{ color:#7d8191; }

    .hint{
      color:#222; margin:18px 10px 6px;
      line-height:1.6;
      font-size:14px;
      display: flex
    }

    /* 按鈕 */
    .btn {
        display: block;
        width: 90%;
        height: var(--btn-height);
        margin: 75px 18px -6px;
        background: var(--brand);
        color: #fff;
        border: none;
        border-radius: 14px;
        font-size: 20px;
        font-weight: 800;
        letter-spacing: .2em;
        cursor: pointer;
    }
    .btn:active{ transform:scale(.98); }

    .msg{ margin:14px 8px 0; font-weight:700; min-height:1.5em;}
    .msg.ok{ color:#0f7a3b; }
    .msg.err{ color:#b00020; }
  </style>
</head>
<body>
  <main class="phone">
    <div class="title-row">
      <img src="https://cdn.jsdelivr.net/gh/tabler/tabler-icons/icons/world-www.svg" alt="icon"/>
      <h1 style="margin:0;font-size:inherit;">T2日動植物檢疫登入系統</h1>
    </div>

    <div class="tip-row">
      <img src="https://cdn.jsdelivr.net/gh/tabler/tabler-icons/icons/info-circle.svg" alt="提醒" />
      <div>提醒：帳號密碼統一後四碼</div>
    </div>

    <label class="field">
      <input id="account" placeholder="帳號：身分證" />
    </label>

    <label class="field">
      <input id="password" type="password" placeholder="密碼：生日" />
    </label>

    <p class="hint">請各位同仁輸入後四碼。</p>

    <button id="loginBtn" class="btn">登入</button>
    <div id="msg" class="msg"></div>
  </main>

  <script src="password.js"></script>
  <script>
    const ACCOUNTS = (window.ACCOUNTS && Array.isArray(window.ACCOUNTS)) ? window.ACCOUNTS : [];
    const accountEl = document.getElementById('account');
    const passwordEl = document.getElementById('password');
    const loginBtn  = document.getElementById('loginBtn');
    const msgEl     = document.getElementById('msg');

    loginBtn.addEventListener('click', login);

    function saveBindingAndGoMain(user, pwd, name, welcome){
      try{
        var binding = user + pwd + '=' + (name || '');
        // ✅ 改成主頁讀得懂的 Key
        localStorage.setItem('t2_user_bind', binding);
        localStorage.setItem('t2_user_name', name || '');
        localStorage.setItem('t2_user_acc', user);

        // （可選）為相容舊版，順手也寫入舊 key，不影響主頁
        localStorage.setItem('binding', binding);
        localStorage.setItem('displayName', name || '');
        localStorage.setItem('welcomeText', welcome || '');
      }catch(e){}
      window.location.href = 'main.html';
    }

    function login(){
      const acc = accountEl.value.trim();
      const pwd = passwordEl.value.trim();
      msgEl.className='msg';
      if(!acc || !pwd){
        msgEl.textContent='請輸入帳號與密碼';
        msgEl.classList.add('err');
        return;
      }
      var hit = null;
      for(var i=0;i<ACCOUNTS.length;i++){
        var x = ACCOUNTS[i];
        if(x.username===acc && x.password===pwd){ hit = x; break; }
      }
      if(hit){
        // 顯示提示（停留極短時間就會跳頁）
        msgEl.textContent = hit.welcome || ('歡迎 ' + (hit._comment || ''));
        msgEl.classList.add('ok');

        // 特別處理需求：如果是 0017 / 5126，建立 00175126=念念 綁定
        if(acc==='0017' && pwd==='5126'){
          saveBindingAndGoMain(acc, pwd, '念念', '歡迎念念');
          return;
        }

        // 其他使用者一般處理：用 _comment 當顯示名稱
        saveBindingAndGoMain(acc, pwd, (hit._comment || ''), (hit.welcome || ''));
      }else{
        msgEl.textContent='帳號或密碼錯誤';
        msgEl.classList.add('err');
      }
    }
  </script>

</body>
</html>

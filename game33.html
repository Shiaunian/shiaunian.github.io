<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T2æ—¥æª¢ç–«æŒ‘æˆ°ç³»çµ±</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
:root {
--bg-primary: #1a1b1e;
--bg-secondary: #2d2d30;
--primary: #7289da;
--primary-dark: #5c6fb1;
--text-primary: #ffffff;
--text-secondary: #a0a0a0;
--danger: #ef4444;
--warning: #f59e0b;
--success: #22c55e;
--shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
--border-color: rgba(255, 255, 255, 0.1);
--info: #3b82f6;
--transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
--border-radius: 8px;
--gold: #fbbf24;
--silver: #9ca3af;
--bronze: #d97706;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: "å¾®è»Ÿæ­£é»‘é«”", -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
background: var(--bg-primary);
min-height: 100vh;
padding: 12px;
color: var(--text-primary);
line-height: 1.5;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}

.container {
max-width: 480px;
margin: 0 auto;
height: calc(100vh - 24px);
overflow-y: auto;
background: var(--bg-secondary);
border-radius: 12px;
box-shadow: var(--shadow);
will-change: scroll-position;
}

.header {
background: var(--bg-secondary);
padding: 15px;
border-bottom: 1px solid var(--border-color);
position: sticky;
top: 0;
z-index: 100;
backdrop-filter: blur(10px);
}

.header-title {
display: flex;
flex-direction: column;
margin-bottom: 10px;
}

.title-text {
font-size: 1.3rem;
color: var(--text-primary);
display: flex;
align-items: center;
gap: 8px;
justify-content: space-between;
}

.user-info {
font-size: 0.9rem;
color: var(--text-secondary);
margin-top: 5px;
display: flex;
align-items: center;
justify-content: space-between;
}

.user-currency {
display: flex;
gap: 12px;
align-items: center;
}

.currency-item {
display: flex;
align-items: center;
gap: 4px;
background: rgba(255, 255, 255, 0.05);
padding: 4px 8px;
border-radius: 4px;
font-size: 0.8rem;
}

.connection-status {
background-color: var(--success);
color: white;
padding: 4px 8px;
border-radius: 4px;
font-size: 0.8rem;
animation: pulse 2s infinite;
}

@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.7; }
}

/* ğŸ¨ æŒ‰éˆ•æ¨£å¼ */
.btn {
padding: 10px 16px;
border: none;
border-radius: var(--border-radius);
cursor: pointer;
font-size: 0.9rem;
font-weight: 500;
transition: var(--transition);
flex: 1;
position: relative;
overflow: hidden;
text-decoration: none;
display: inline-flex;
align-items: center;
justify-content: center;
gap: 6px;
min-height: 44px;
}

.btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
transition: left 0.5s;
}

.btn:hover::before {
left: 100%;
}

.btn-primary {
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: var(--text-primary);
box-shadow: 0 2px 8px rgba(114, 137, 218, 0.3);
}

.btn-primary:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(114, 137, 218, 0.4);
}

.btn-secondary {
background: linear-gradient(135deg, var(--warning), #e67e22);
color: var(--text-primary);
box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
}

.btn-secondary:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
}

.btn-danger {
background: linear-gradient(135deg, var(--danger), #c0392b);
color: var(--text-primary);
box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
}

.btn-danger:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}

.btn-shop {
background: linear-gradient(135deg, var(--gold), #f59e0b);
color: var(--text-primary);
box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
}

.btn-shop:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
}

/* header-actions æŒ‰éˆ•ä½ˆå±€ */
.header-actions {
display: flex;
gap: 8px;
margin-top: 12px;
}

.header-actions .btn {
flex: 1;
font-size: 0.8rem;
padding: 8px 10px;
min-height: 36px;
}

/* ğŸ… å‹³ç« é¡¯ç¤ºæ¨£å¼ */
.user-medals {
display: flex;
gap: 4px;
margin-top: 8px;
flex-wrap: wrap;
}

.medal-icon {
display: inline-flex;
align-items: center;
justify-content: center;
width: 28px;
height: 28px;
border-radius: 50%;
font-size: 0.9rem;
border: 2px solid;
background: rgba(255, 255, 255, 0.1);
transition: var(--transition);
cursor: pointer;
overflow: hidden; /* ğŸ”§ æ–°å¢ï¼šé˜²æ­¢åœ–ç‰‡æº¢å‡º */
}

.medal-icon:hover {
transform: scale(1.1);
}

.medal-icon.common { border-color: #84cc16; }
.medal-icon.rare { border-color: #3b82f6; }
.medal-icon.epic { border-color: #8b5cf6; }
.medal-icon.legendary { border-color: #f59e0b; }

/* ğŸ”§ æ–°å¢ï¼šå‹³ç« åœ–ç‰‡æ¨£å¼ */
.medal-icon img,
.medal-preview img,
.inventory-medal-icon img,
.leaderboard-medal img {
border-radius: 4px;
display: block;
}

/* ğŸª å•†åº—æ¨£å¼ */
.shop-container {
padding: 16px;
}

.shop-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}

.shop-categories {
display: flex;
gap: 8px;
margin-bottom: 16px;
}

.category-btn {
padding: 8px 16px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid var(--border-color);
border-radius: var(--border-radius);
color: var(--text-secondary);
cursor: pointer;
transition: var(--transition);
font-size: 0.85rem;
}

.category-btn.active {
background: var(--primary);
color: var(--text-primary);
border-color: var(--primary);
}

.shop-items {
display: grid;
gap: 12px;
}

.shop-item {
display: flex;
align-items: center;
padding: 12px;
background: rgba(255, 255, 255, 0.03);
border: 1px solid var(--border-color);
border-radius: var(--border-radius);
transition: var(--transition);
}

.shop-item:hover {
background: rgba(255, 255, 255, 0.05);
transform: translateY(-1px);
}

.shop-item.owned {
opacity: 0.6;
border-color: var(--success);
}

.shop-item.equipped {
border-color: var(--gold);
background: rgba(251, 191, 36, 0.1);
}

.medal-preview {
width: 40px;
height: 40px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 1.2rem;
border: 2px solid;
margin-right: 12px;
}

.item-info {
flex: 1;
}

.item-name {
font-weight: 600;
margin-bottom: 4px;
}

.item-description {
font-size: 0.8rem;
color: var(--text-secondary);
margin-bottom: 4px;
}

.item-price {
font-size: 0.9rem;
color: var(--gold);
font-weight: 600;
}

.item-actions {
display: flex;
gap: 8px;
}

.btn-small {
padding: 6px 12px;
font-size: 0.8rem;
min-height: 32px;
}

/* ğŸ’ èƒŒåŒ…æ¨£å¼ */
.inventory-container {
padding: 16px;
}

.inventory-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
gap: 12px;
}

.inventory-item {
aspect-ratio: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
background: rgba(255, 255, 255, 0.03);
border: 2px solid var(--border-color);
border-radius: var(--border-radius);
cursor: pointer;
transition: var(--transition);
padding: 8px;
}

.inventory-item:hover {
background: rgba(255, 255, 255, 0.08);
transform: translateY(-2px);
}

.inventory-item.equipped {
border-color: var(--gold);
background: rgba(251, 191, 36, 0.1);
}

.inventory-medal-icon {
font-size: 1.5rem;
margin-bottom: 4px;
}

.inventory-medal-name {
font-size: 0.7rem;
text-align: center;
line-height: 1.2;
}

/* æ’è¡Œæ¦œå‹³ç« é¡¯ç¤º */
.leaderboard-medals {
display: flex;
gap: 2px;
margin-left: 8px;
}

.leaderboard-medal {
width: 16px;
height: 16px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.6rem;
border: 1px solid;
}

/* å…¶ä»–ç¾æœ‰æ¨£å¼ä¿æŒä¸è®Š... */
.challenge-item {
padding: 16px;
border-bottom: 1px solid var(--border-color);
transition: background-color 0.3s ease;
}

.challenge-item:hover {
background: rgba(255, 255, 255, 0.02);
}

.challenge-title {
font-size: 1.1rem;
color: var(--text-primary);
margin-bottom: 8px;
font-weight: 600;
}

.challenge-info {
color: var(--text-secondary);
font-size: 0.9rem;
margin-bottom: 12px;
}

.challenge-actions {
display: flex;
gap: 10px;
}

.champion-display {
margin-bottom: 10px;
}

.champion-card {
display: flex;
align-items: center;
justify-content: space-between;
background: linear-gradient(45deg, #FFD700, #FFA500);
color: #000;
padding: 8px 14px;
border-radius: var(--border-radius);
font-size: 0.85rem;
font-weight: bold;
box-shadow: 0 3px 6px rgba(255, 215, 0, 0.3);
transition: var(--transition);
}

.champion-card:hover {
transform: translateY(-1px);
box-shadow: 0 4px 8px rgba(255, 215, 0, 0.4);
}

.champion-empty {
display: flex;
align-items: center;
justify-content: center;
background: rgba(255, 255, 255, 0.05);
color: var(--text-secondary);
padding: 8px 14px;
border-radius: var(--border-radius);
font-size: 0.85rem;
border: 1px dashed rgba(255, 255, 255, 0.15);
}

.modal-overlay {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0, 0, 0, 0.8);
display: none;
justify-content: center;
align-items: center;
z-index: 1000;
backdrop-filter: blur(4px);
animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

.modal {
background: var(--bg-secondary);
width: 90%;
max-width: 420px;
max-height: 85vh;
border-radius: 12px;
overflow: hidden;
position: relative;
box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
animation: slideUp 0.3s ease;
}

@keyframes slideUp {
from { transform: translateY(30px); opacity: 0; }
to { transform: translateY(0); opacity: 1; }
}

.modal-header {
padding: 16px;
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: var(--text-primary);
display: flex;
justify-content: space-between;
align-items: center;
position: sticky;
top: 0;
}

.close-btn {
background: none;
border: none;
color: var(--text-primary);
font-size: 1.5rem;
cursor: pointer;
padding: 4px 8px;
border-radius: 4px;
transition: var(--transition);
}

.close-btn:hover {
background: rgba(255, 255, 255, 0.1);
transform: scale(1.1);
}

.modal-content {
padding: 16px;
overflow-y: auto;
max-height: calc(85vh - 68px);
min-height: 200px;
}

.leaderboard-container {
max-height: calc(60vh - 100px);
overflow-y: auto;
padding-right: 5px;
scroll-behavior: smooth;
}

.leaderboard-item {
display: flex;
align-items: center;
padding: 10px 12px;
border-bottom: 1px solid var(--border-color);
transition: var(--transition);
border-radius: 6px;
margin-bottom: 2px;
}

.leaderboard-item:hover {
background: rgba(114, 137, 218, 0.05);
transform: translateX(2px);
}

.leaderboard-item.current-user {
background: rgba(114, 137, 218, 0.1);
border-left: 3px solid var(--primary);
box-shadow: 0 2px 8px rgba(114, 137, 218, 0.2);
}

.rank {
min-width: 35px;
font-weight: bold;
color: var(--primary);
font-size: 1rem;
}

.user-name {
flex: 1;
margin: 0 12px;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
display: flex;
align-items: center;
}

.score {
font-weight: bold;
color: var(--primary);
margin-left: auto;
font-size: 1rem;
}

.empty-leaderboard {
text-align: center;
padding: 30px 20px;
color: var(--text-secondary);
}

/* éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 400px) {
.header-actions {
flex-direction: column;
gap: 8px;
}
.header-actions .btn {
width: 100%;
}
.user-currency {
flex-direction: column;
gap: 4px;
}
}

/* GPU åŠ é€Ÿ */
.btn, .modal, .leaderboard-item, .champion-card, .medal-icon {
transform: translateZ(0);
backface-visibility: hidden;
}

/* å…¶ä»–ç¾æœ‰æ¨£å¼... */
.exam-container { padding: 20px; }
.exam-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 16px; background: rgba(255, 255, 255, 0.03); border-radius: var(--border-radius); }
.timer { font-size: 1.4rem; color: var(--primary); font-weight: bold; padding: 8px 16px; background: rgba(114, 137, 218, 0.1); border-radius: var(--border-radius); }
.question { background: rgba(255, 255, 255, 0.03); padding: 24px; border-radius: var(--border-radius); margin-bottom: 20px; border: 1px solid var(--border-color); }
.options { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-top: 20px; }
.option-btn { width: 100%; text-align: left; padding: 14px 16px; border-radius: var(--border-radius); transition: var(--transition); }
.option-btn.correct { background: linear-gradient(135deg, var(--success), #27ae60); }
.option-btn.wrong { background: linear-gradient(135deg, var(--danger), #c0392b); }
.exam-result { text-align: center; padding: 30px 20px; }
.exam-result h2 { margin-bottom: 20px; color: var(--primary); }
.exam-result p { margin-bottom: 12px; font-size: 1.05rem; }
.exam-result button { margin: 8px; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-primary); border-radius: 3px; }
::-webkit-scrollbar-thumb { background: linear-gradient(to bottom, var(--primary), var(--primary-dark)); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: linear-gradient(to bottom, var(--primary-dark), var(--primary)); }
.sudoku-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; background: var(--border-color); padding: 8px; border-radius: var(--border-radius); margin-bottom: 20px; }
.sudoku-cell { width: 100%; aspect-ratio: 1; background: var(--bg-primary); border: 2px solid transparent; border-radius: 6px; color: var(--text-primary); font-size: 1.5rem; text-align: center; cursor: pointer; transition: var(--transition); }
.sudoku-cell:disabled { background: var(--bg-secondary); color: var(--text-secondary); cursor: not-allowed; }
.sudoku-cell:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(114, 137, 218, 0.3); }
.sudoku-cell::-webkit-inner-spin-button, .sudoku-cell::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
.loading { text-align: center; padding: 40px 20px; color: var(--text-secondary); }
.loading-spinner { display: inline-block; width: 24px; height: 24px; border: 3px solid rgba(114, 137, 218, 0.3); border-top: 3px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-right: 12px; will-change: transform; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@media (max-width: 400px) { .options { grid-template-columns: 1fr; } }
.btn:focus-visible { outline: 2px solid var(--primary); outline-offset: 2px; }
::selection { background: rgba(114, 137, 218, 0.3); color: var(--text-primary); }
</style>
</head>
<body>
<!-- è¼‰å…¥ä¸­ç•«é¢ -->
<div id="loadingScreen" class="container">
<div class="loading">
<div class="loading-spinner"></div>
æ­£åœ¨é©—è­‰ç™»å…¥ç‹€æ…‹...
</div>
</div>

<!-- ä¸»è¦å…§å®¹ -->
<div id="mainContent" class="container" style="display: none;">
<header class="header">
<div class="header-title">
<div class="title-text">
<span>ğŸ¯</span>
<h1>T2æ—¥æª¢ç–«æŒ‘æˆ°ç³»çµ±</h1>
<button class="btn btn-danger" onclick="logout()">ç™»å‡º</button>
</div>
<div class="user-info">
<div>
<span id="currentUserWelcome">æ­¡è¿å›ä¾†ï¼Œè¼‰å…¥ä¸­...</span>
<div class="user-currency">
<div class="currency-item">
  <span>ğŸ’°</span>
  <span id="userCoins">0</span>
</div>
<div class="currency-item">
  <span>ğŸ’</span>
  <span id="userGems">0</span>
</div>
</div>
<div class="user-medals" id="userMedals"></div>
</div>
<span class="connection-status" id="connectionStatus">ç”¨æˆ¶é€£ç·šä¸­</span>
</div>
</div>
<div class="header-actions">
<button class="btn btn-primary" onclick="backToT2()">ğŸ  è¿”å›T2æ—¥</button>
<button class="btn btn-secondary" onclick="showTotalLeaderboard()">ğŸ† ç¸½åˆ†æ’è¡Œæ¦œ</button>
<button class="btn btn-shop" onclick="showShop()">ğŸª å•†åº—</button>
<button class="btn btn-primary" onclick="showInventory()">ğŸ’ èƒŒåŒ…</button>
</div>
</header>

<!-- æŒ‘æˆ°é …ç›®åˆ—è¡¨ - å°‡å‹•æ…‹ç”Ÿæˆ -->
<div id="challengesList">
<!-- æŒ‘æˆ°é …ç›®å°‡åœ¨æ­¤å‹•æ…‹ç”Ÿæˆ -->
</div>
</div>

<!-- ğŸª å•†åº—æ¨¡æ…‹è¦–çª— -->
<div class="modal-overlay" id="shopModal">
<div class="modal">
<div class="modal-header">
<h2>ğŸª å‹³ç« å•†åº—</h2>
<button class="close-btn" onclick="hideShop()">Ã—</button>
</div>
<div class="modal-content">
<div class="shop-container">
<div class="shop-categories">
<button class="category-btn active" onclick="filterShop('all')">å…¨éƒ¨</button>
<button class="category-btn" onclick="filterShop('common')">æ™®é€š</button>
<button class="category-btn" onclick="filterShop('rare')">ç¨€æœ‰</button>
<button class="category-btn" onclick="filterShop('epic')">å²è©©</button>
<button class="category-btn" onclick="filterShop('legendary')">å‚³èªª</button>
</div>
<div class="shop-items" id="shopItems">
<!-- å•†åº—ç‰©å“å°‡åœ¨æ­¤å‹•æ…‹ç”Ÿæˆ -->
</div>
</div>
</div>
</div>
</div>

<!-- ğŸ’ èƒŒåŒ…æ¨¡æ…‹è¦–çª— -->
<div class="modal-overlay" id="inventoryModal">
<div class="modal">
<div class="modal-header">
<h2>ğŸ’ å‹³ç« èƒŒåŒ…</h2>
<button class="close-btn" onclick="hideInventory()">Ã—</button>
</div>
<div class="modal-content">
<div class="inventory-container">
<p style="margin-bottom: 16px; color: var(--text-secondary);">é»æ“Šå‹³ç« è£å‚™/å¸ä¸‹ (æœ€å¤šè£å‚™5å€‹)</p>
<div class="inventory-grid" id="inventoryGrid">
<!-- èƒŒåŒ…ç‰©å“å°‡åœ¨æ­¤å‹•æ…‹ç”Ÿæˆ -->
</div>
</div>
</div>
</div>
</div>

<!-- æ’è¡Œæ¦œæ¨¡æ…‹è¦–çª— -->
<div class="modal-overlay" id="leaderboardModal">
<div class="modal">
<div class="modal-header">
<h2 id="modalTitle">æ’è¡Œæ¦œ</h2>
<button class="close-btn" onclick="hideLeaderboard()">Ã—</button>
</div>
<div class="modal-content" id="leaderboardContent">
</div>
</div>
</div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <!-- ä¿æŒä½ ç¾æœ‰çš„æ‰€æœ‰ CSS æ¨£å¼ä¸è®Š -->
  <style>
      /* ä½ ç¾æœ‰çš„æ‰€æœ‰ CSS æ¨£å¼ */
  </style>
</head>
<body>
  <!-- è¼‰å…¥ä¸­ç•«é¢ -->
  <div id="loadingScreen" class="container">
      <div class="loading">
          <div class="loading-spinner"></div>
          <span id="loadingText">è¼‰å…¥ä¸­...</span>
      </div>
  </div>

  <!-- ä½ ç¾æœ‰çš„æ‰€æœ‰ HTML çµæ§‹ä¿æŒä¸è®Š -->
  <div id="mainContent" class="container" style="display: none;">
      <!-- ... ä¿æŒç¾æœ‰HTMLçµæ§‹ ... -->
  </div>

  <script>
      // ğŸ¯ é…ç½®ç®¡ç†å™¨
      class ConfigManager {
          static configs = {};
          
          static async init() {
              try {
                  const [systemConfig, uiTexts, rewardsConfig] = await Promise.all([
                      this.loadJSON('system-config.json'),
                      this.loadJSON('ui-texts.json'),
                      this.loadJSON('rewards-config.json')
                  ]);
                  
                  this.configs = {
                      system: systemConfig,
                      ui: uiTexts,
                      rewards: rewardsConfig
                  };
                  
                  console.log('âœ… é…ç½®å·²è¼‰å…¥');
                  return this.configs;
              } catch (err) {
                  console.error('è¼‰å…¥é…ç½®å¤±æ•—:', err);
                  // æä¾›é è¨­é…ç½®
                  this.configs = this.getDefaultConfigs();
                  return this.configs;
              }
          }
          
          static async loadJSON(file) {
              const response = await fetch(file);
              if (!response.ok) throw new Error(`è¼‰å…¥ ${file} å¤±æ•—`);
              return response.json();
          }
          
          static getText(path) {
              return this.getNestedValue(this.configs.ui, path) || path;
          }
          
          static getConfig(section, path) {
              return this.getNestedValue(this.configs[section], path);
          }
          
          static getNestedValue(obj, path) {
              return path.split('.').reduce((o, p) => o && o[p], obj);
          }
          
          static formatText(template, params) {
              if (!template) return '';
              return template.replace(/\{(\w+)\}/g, (match, key) => params[key] || match);
          }
          
          static getDefaultConfigs() {
              return {
                  system: {
                      firebase: {
                          apiKey: "AIzaSyBVC5zJl6LCKFrsdN7_JkVsZHmqALuixwE",
                          authDomain: "openexammodal.firebaseapp.com",
                          databaseURL: "https://openexammodal-default-rtdb.firebaseio.com",
                          projectId: "openexammodal",
                          storageBucket: "openexammodal.firebasestorage.app",
                          messagingSenderId: "336901617556",
                          appId: "1:336901617556:web:53f60cddf513b2ea6a4181"
                      },
                      session: { loginTimeout: 3600000 },
                      ui: { maxEquippedMedals: 5 }
                  },
                  ui: {
                      messages: {
                          loginCheck: "æ­£åœ¨é©—è­‰ç™»å…¥ç‹€æ…‹...",
                          systemError: "ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢"
                      }
                  },
                  rewards: {
                      scoring: { pointsPerCorrect: 10, coinsPerCorrect: 5 }
                  }
              };
          }
      }

      // ğŸ¯ ä¿®æ”¹ç¾æœ‰è®Šæ•¸å’Œå‡½æ•¸
      let currentUser = null;
      let usersData = [];
      let database = null;
      let examQuestions = {};
      let medalsData = {};
      let userMedals = { owned: [], equipped: [] };
      let userCurrency = { coins: 0, gems: 0 };
      let examConfigs = {};

      // ğŸ¯ ä¿®æ”¹åˆå§‹åŒ–å‡½æ•¸
      async function initializeApp() {
          try {
              // è¼‰å…¥é…ç½®
              await ConfigManager.init();
              
              // æ›´æ–°è¼‰å…¥æ–‡å­—
              document.getElementById('loadingText').textContent = 
                  ConfigManager.getText('messages.loginCheck');
              
              // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
              const user = checkLoginStatus();
              if (!user) return;

              currentUser = user;
              
              // æ›´æ–°æ­¡è¿æ–‡å­—
              const welcomeText = ConfigManager.formatText(
                  ConfigManager.getText('messages.welcomeBack'),
                  { username: user }
              );
              document.getElementById('currentUserWelcome').textContent = welcomeText;

              // åˆå§‹åŒ– Firebase
              firebase.initializeApp(ConfigManager.getConfig('system', 'firebase'));
              database = firebase.database();

              // è¼‰å…¥è³‡æ–™
              await Promise.all([
                  loadExamQuestions(),
                  loadUsersData(),
                  loadMedalsData(),
                  loadExamConfigs()
              ]);

              await loadUserMedalsAndCurrency();
              renderChallengesList();
              await updateAllChampions();

              document.getElementById('loadingScreen').style.display = 'none';
              document.getElementById('mainContent').style.display = 'block';

          } catch (err) {
              console.error('åˆå§‹åŒ–å¤±æ•—:', err);
              alert(ConfigManager.getText('messages.systemError'));
          }
      }

      // ğŸ¯ ä¿®æ”¹ç™»å…¥æª¢æŸ¥å‡½æ•¸
      function checkLoginStatus() {
          const config = ConfigManager.getConfig('system', 'session');
          const keys = ConfigManager.getConfig('system', 'session.storageKeys') || {
              loginFlag: 't2_login',
              loginTime: 't2_login_time',
              loginUser: 't2_login_user',
              loginPassword: 't2_login_password'
          };
          
          const flag = localStorage.getItem(keys.loginFlag);
          const time = localStorage.getItem(keys.loginTime);
          const user = localStorage.getItem(keys.loginUser);
          
          if (flag !== 'yes' || !time || !user) {
              forceLogout(ConfigManager.getText('messages.loginInvalid'));
              return false;
          }
          
          const timeout = config?.loginTimeout || 3600000;
          if (Date.now() - parseInt(time) > timeout) {
              forceLogout(ConfigManager.getText('messages.loginExpired'));
              return false;
          }
          
          return user;
      }

      // ğŸ¯ ä¿®æ”¹å¼·åˆ¶ç™»å‡ºå‡½æ•¸
      function forceLogout(message) {
          const keys = ConfigManager.getConfig('system', 'session.storageKeys') || {
              loginFlag: 't2_login',
              loginTime: 't2_login_time',
              loginUser: 't2_login_user',
              loginPassword: 't2_login_password'
          };
          
          Object.values(keys).forEach(key => localStorage.removeItem(key));
          
          alert(message);
          const homePage = ConfigManager.getConfig('system', 'navigation.homePage') || 'index3.html';
          window.location.href = homePage;
      }

      // ğŸ¯ ä¿®æ”¹è³¼è²·å‹³ç« å‡½æ•¸
      async function buyMedal(medalId) {
          const medal = medalsData.medals[medalId];
          if (!medal || userMedals.owned.includes(medalId)) return;

          if (userCurrency.coins < medal.price) {
              alert(ConfigManager.getText('messages.insufficientFunds'));
              return;
          }

          const confirmText = ConfigManager.formatText(
              ConfigManager.getText('messages.buyConfirm'),
              { medalIcon: medal.icon, medalName: medal.name, price: medal.price }
          );

          if (confirm(confirmText)) {
              userCurrency.coins -= medal.price;
              userMedals.owned.push(medalId);

              await Promise.all([saveMedalData(), saveCurrencyData()]);
              await renderShopItems();
              
              const successText = ConfigManager.formatText(
                  ConfigManager.getText('messages.buySuccess'),
                  { medalIcon: medal.icon, medalName: medal.name }
              );
              alert(successText);
          }
      }

      // ä¿æŒæ‰€æœ‰å…¶ä»–ç¾æœ‰å‡½æ•¸ï¼Œåªéœ€è¦é€æ­¥æ›¿æ›æ–‡å­—ç‚º ConfigManager.getText() èª¿ç”¨
      
      // ä½ ç¾æœ‰çš„æ‰€æœ‰å…¶ä»–å‡½æ•¸...
      // (ç‚ºäº†ç°¡æ½”ï¼Œé€™è£¡çœç•¥ï¼Œä½†å¯¦éš›ä¸Šéœ€è¦ä¿æŒæ‰€æœ‰ç¾æœ‰å‡½æ•¸)
      
      // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>
